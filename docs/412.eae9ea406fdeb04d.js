"use strict";(self.webpackChunktanks=self.webpackChunktanks||[]).push([[412],{6412:(tt,Y,W)=>{W.r(Y),W.d(Y,{DemoModule:()=>Z});var U=W(8692);function X(d,t,i,s,e,r,u){try{var c=d[r](u),a=c.value}catch(m){return void i(m)}c.done?t(a):Promise.resolve(a).then(s,e)}function x(d){return function(){var t=this,i=arguments;return new Promise(function(s,e){var r=d.apply(t,i);function u(a){X(r,s,e,u,c,"next",a)}function c(a){X(r,s,e,u,c,"throw",a)}u(void 0)})}}var R=Object.defineProperty,h=(d,t,i)=>((d,t,i)=>t in d?R(d,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[t]=i)(d,"symbol"!=typeof t?t+"":t,i);const f=Object.freeze({Dev:"dev",Prod:"prod"}),k=f.Prod;class l{constructor(t,i){h(this,"X",0),h(this,"Y",0),this.X=t,this.Y=i}}class n{}h(n,"right",0),h(n,"bottom",1),h(n,"left",2),h(n,"top",3);class D{constructor(t,i,s){h(this,"road",0),h(this,"wall",1),h(this,"closeRoad",2),h(this,"redBase",3),h(this,"blueBase",4),h(this,"bullet",5),h(this,"water",6),h(this,"sand",7),h(this,"hpRegenRed",8),h(this,"hpRegenBlue",9),h(this,"cpRegen",10),h(this,"next",11),h(this,"units",[]),h(this,"towers",[]),h(this,"mobs",[]),h(this,"homes",[]);for(let e=0;e<t;++e)this.units.push(this.next+e);for(let e=0;e<t;++e)this.homes.push(this.next+t+e);for(let e=0;e<i;++e)this.towers.push(this.next+2*t+e);for(let e=0;e<s;++e)this.mobs.push(this.next+2*t+i+e)}}class v{constructor(){h(this,"coords",new l(0,0)),h(this,"pastCoords",new l(0,0)),h(this,"renderCoords",new l(0,0)),h(this,"crashCoords",new l(0,0)),h(this,"renderCrashCoords",new l(0,0)),h(this,"deltaCoords",new l(0,0)),h(this,"perimCoords",[])}}class o{constructor(t=0,i=0,s=0,e=0,r=0){this.id=r,this.width=s,this.height=e,this.TLX=t,this.TLY=i,this.BRX=this.TLX+this.width,this.BRY=this.TLY+this.height}update(t){this.TLX=t.X,this.TLY=t.Y,this.BRX=this.TLX+this.width,this.BRY=this.TLY+this.height}}class A{constructor(t="T_2",i=20,s=20,e=6,r=2,u=200,c=600,a=1,m=0,w=0){this.model=t,this.health=i,this.armor=s,this.speed=e,this.shotPower=r,this.shotDistance=u,this.respawnTime=c,this.level=a,this.experience=m,this.commandPoints=w}}function y(d,t){return Math.floor(Math.random()*(t-d)+d)}class P extends o{constructor(t){super(),h(this,"map",null),h(this,"pos",null),h(this,"owner",null),h(this,"target",null),h(this,"turn",0),h(this,"speed",0),h(this,"bulletType",{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new l(0,0),boom_coords:new l(0,0)}),h(this,"hit",!1),h(this,"hitMiss",!1),h(this,"degree",0),this.map=t.map,this.pos=new v,this.owner=t,this.id=t.id,this.bulletType=t.ammunition[t.bulletType]}look(){let t=this.pos.coords.X+Math.round(this.map.unitWidth/3),i=this.pos.coords.Y+Math.round(this.map.unitWidth/3),s=[];this.update(new l(t,i));for(let e=0;e<this.map.backArray.length;++e)this.BRX<this.map.backArray[e].TLX||this.TLX>this.map.backArray[e].BRX||this.BRY<this.map.backArray[e].TLY||this.TLY>this.map.backArray[e].BRY||s.push(this.map.backArray[e].id);return 0===s.length&&s.push(this.map.backId.road),s}fatalHit(){return null!==this.target&&this.target.uc.health<=0?(this.target.uc.health=0,this.target):(this.target=null,null)}hitResult(){return y(this.bulletType.damage,this.owner.uc.shotPower+this.bulletType.damage)}checkHitMiss(t){return t.forEach(i=>{this.hitMiss=i===this.map.backId.wall}),this.hitMiss}checkHit(t){this.hit=!1;for(let i of this.owner.targets)t.forEach(s=>{if(s===i.id&&i.uc.health>0){this.target=i;let e=this.hitResult();i.uc.armor=i.uc.armor-2*e/3,i.uc.armor<=0?(i.uc.armor=0,i.uc.health=i.uc.health-e):i.uc.health=i.uc.health-e/3,this.hit=!0}});return this.hit}moveHelper(t,i){let s=Math.cos(this.degree*Math.PI/180)*i,e=Math.sin(this.degree*Math.PI/180)*i;t.X+=Math.round(s),t.Y+=Math.round(e)}move(){0===this.speed&&(this.pos.coords=Object.assign({},this.owner.pos.coords),this.pos.renderCoords=Object.assign({},this.owner.pos.renderCoords),this.degree=this.owner.gun.degree,this.turn=this.owner.turn,this.bulletType=this.owner.ammunition[this.owner.bulletType],--this.owner.ammunition[this.owner.bulletType].quantity);let t=Math.floor(this.owner.uc.shotDistance/10);this.moveHelper(this.pos.coords,t),this.moveHelper(this.pos.renderCoords,t);let i=this.look();++this.speed,(this.checkHitMiss(i)||this.checkHit(i))&&(this.speed=0),this.speed>10&&(this.speed=0)}}class M extends o{constructor(t=new A,i={model:"gun_2",degree:0},s=[{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new l(0,0),boom_coords:new l(0,0)}],e=0){super(),h(this,"userId","None"),h(this,"name","NoName"),h(this,"side","red"),h(this,"homeId",1111),h(this,"ability",0),h(this,"turn",0),h(this,"bulletType",0),h(this,"reload",0),h(this,"speedController",1),h(this,"trigger",!1),h(this,"uc",null),h(this,"etalonUc",null),h(this,"kill",null),h(this,"map",null),h(this,"bullet",null),h(this,"pos",null),h(this,"targets",null),h(this,"allies",null),h(this,"ammunition",null),h(this,"gun",null),this.uc=t,this.etalonUc=Object.assign({},this.uc),this.ammunition=s,this.bullet=new P(this),this.pos=new v,this.gun=i,this.ability=e}levelUp(){null!==this.kill&&(this.uc.experience+=this.kill.etalonUc.health,this.uc.experience>20*this.uc.level&&(this.uc.experience-=20*this.uc.level,++this.uc.level,++this.etalonUc.level,++this.uc.commandPoints,++this.etalonUc.commandPoints,this.uc.level%2==0&&(this.etalonUc.health+=5),this.uc.level%2!=0&&(this.etalonUc.armor+=5),this.etalonUc.speed<12&&this.uc.level%3==0&&(this.uc.speed+=1,this.etalonUc.speed+=1),this.etalonUc.shotPower<=10&&this.uc.level%2!=0&&(this.uc.shotPower+=1,this.etalonUc.shotPower+=1))),this.experienceToLevel=20*this.uc.level}roadEffect(t){"red"===this.side?(t===this.map.backId.hpRegenRed&&this.uc.health<this.etalonUc.health&&(this.uc.health+=.1),t===this.map.backId.hpRegenBlue&&this.uc.health>=0&&(this.uc.health-=.1)):(t===this.map.backId.hpRegenBlue&&this.uc.health<this.etalonUc.health&&(this.uc.health+=.1),t===this.map.backId.hpRegenRed&&this.uc.health>=0&&(this.uc.health-=.1)),t===this.map.backId.cpRegen&&this.uc.armor<this.etalonUc.armor&&(this.uc.armor+=.1),t===this.map.backId.sand&&(this.uc.speed=2,this.speedController=2)}checkFrontWay(t){let i=!1,s=this.look(t),e=!0;return s.forEach(r=>{r===this.map.backId.hpRegenRed||r===this.map.backId.cpRegen||r===this.map.backId.hpRegenBlue||r===this.map.backId.sand?i=!0:e=r===this.map.backId.road,i?this.roadEffect(r):this.uc.speed=this.etalonUc.speed}),e}look(t){this.update(this.pos.coords);let i=[];switch(this.turn){case n.right:for(let s=0;s<this.map.backArray.length;++s)this.BRX+t+1<this.map.backArray[s].TLX||this.TLX+t+1>this.map.backArray[s].BRX||this.BRY<this.map.backArray[s].TLY||this.TLY>this.map.backArray[s].BRY||this.id===this.map.backArray[s].id||this.homeId===this.map.backArray[s].id||i.push(this.map.backArray[s].id);break;case n.bottom:for(let s=0;s<this.map.backArray.length;++s)this.BRX<this.map.backArray[s].TLX||this.TLX>this.map.backArray[s].BRX||this.BRY+t+1<this.map.backArray[s].TLY||this.TLY+t+1>this.map.backArray[s].BRY||this.id===this.map.backArray[s].id||this.homeId===this.map.backArray[s].id||i.push(this.map.backArray[s].id);break;case n.left:for(let s=0;s<this.map.backArray.length;++s)this.BRX-t-1<this.map.backArray[s].TLX||this.TLX-t-1>this.map.backArray[s].BRX||this.BRY<this.map.backArray[s].TLY||this.TLY>this.map.backArray[s].BRY||this.id===this.map.backArray[s].id||this.homeId===this.map.backArray[s].id||i.push(this.map.backArray[s].id);break;case n.top:for(let s=0;s<this.map.backArray.length;++s)this.BRX<this.map.backArray[s].TLX||this.TLX>this.map.backArray[s].BRX||this.BRY-t-1<this.map.backArray[s].TLY||this.TLY-t-1>this.map.backArray[s].BRY||this.id===this.map.backArray[s].id||this.homeId===this.map.backArray[s].id||i.push(this.map.backArray[s].id)}return 0===i.length&&i.push(this.map.backId.road),i}setPosition(t,i){switch(this.turn){case n.right:this.pos.coords.X=i?this.pos.coords.X+t:this.pos.coords.X-t;break;case n.bottom:this.pos.coords.Y=i?this.pos.coords.Y+t:this.pos.coords.Y-t;break;case n.left:this.pos.coords.X=i?this.pos.coords.X-t:this.pos.coords.X+t;break;case n.top:this.pos.coords.Y=i?this.pos.coords.Y-t:this.pos.coords.Y+t}this.update(this.pos.coords)}searchTarget(t){return t.pos.coords.X<this.pos.coords.X+this.uc.shotDistance&&t.pos.coords.X>this.pos.coords.X-this.uc.shotDistance&&t.pos.coords.Y<this.pos.coords.Y+this.uc.shotDistance&&t.pos.coords.Y>this.pos.coords.Y-this.uc.shotDistance&&t.uc.health>0}}class b extends M{constructor(t="Blue",i="T_2",s=100,e=20,r=5,u=1,c=200,a=100,m={model:"gun_2",degree:0,coords:new l(0,0)},w=[{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new l(0,0),boom_coords:new l(0,0)}],q=0){super(new A(i,s,e,r,u,c,a),m,w,q),h(this,"directionPriority",!0),h(this,"turnFlag",!0),h(this,"counter",0),h(this,"target",null),h(this,"name","Bot"),this.side=t.toLowerCase()}checkTarget1(t){switch(this.turn){case n.right:{this.turn=this.directionPriority?n.top:n.bottom;let i=this.checkCollision(!1);return this.turn=n.right,this.pos.coords.X<t.pos.coords.X||i}case n.bottom:{this.turn=this.directionPriority?n.right:n.left;let i=this.checkCollision(!1);return this.turn=n.bottom,this.pos.coords.Y<t.pos.coords.Y||i}case n.left:{this.turn=this.directionPriority?n.bottom:n.top;let i=this.checkCollision(!1);return this.turn=n.left,this.pos.coords.X>t.pos.coords.X||i}case n.top:{this.turn=this.directionPriority?n.left:n.right;let i=this.checkCollision(!1);return this.turn=n.top,this.pos.coords.Y>t.pos.coords.Y||i}}return!0}checkTarget2(t){let i=this.uc.shotDistance-Math.round(this.uc.shotDistance/4),s=t.id!==this.map.backId.redBase&&t.id!==this.map.backId.blueBase?this.map.unitWidth+2:Math.round(this.map.unitWidth/2);switch(this.turn){case n.right:return this.pos.coords.X<t.pos.coords.X-i||this.pos.coords.Y>t.pos.coords.Y+s||this.pos.coords.Y<t.pos.coords.Y-s;case n.bottom:return this.pos.coords.Y<t.pos.coords.Y-i||this.pos.coords.X>t.pos.coords.X+s||this.pos.coords.X<t.pos.coords.X-s;case n.left:return this.pos.coords.X>t.pos.coords.X+i||this.pos.coords.Y>t.pos.coords.Y+s||this.pos.coords.Y<t.pos.coords.Y-s;case n.top:return this.pos.coords.Y>t.pos.coords.Y+i||this.pos.coords.X>t.pos.coords.X+s||this.pos.coords.X<t.pos.coords.X-s}return!0}checkCollision(t){let i=!1;if(t)for(let s=this.uc.speed;s>0&&(i=!1,this.setPosition(s,!0),this.checkFrontWay(s)||(this.setPosition(s,!1),i=!0),!1!==i);--s);else this.checkFrontWay(this.uc.speed)||(i=!0);return i}hunt(t){this.turnGun(t),null!==t&&this.uc.health>0&&(this.directionPriority?!1===this.turnFlag&&this.turn===n.top?this.turn=n.right:!1===this.turnFlag&&(this.turn+=1):!1===this.turnFlag&&this.turn===n.right?this.turn=n.top:!1===this.turnFlag&&(this.turn-=1),"red"===this.side&&this.turnFlag?this.directionPriority=this.pos.coords.Y<Math.round(this.map.frontHeight/2):this.turnFlag&&(this.directionPriority=this.pos.coords.Y>Math.round(this.map.frontHeight/2)),this.turnFlag=!0,this.checkTarget1(t)?this.checkTarget2(t)&&this.checkCollision(!0)&&this.checkCollision(!1)&&(this.turn=this.directionPriority?this.turn-1:this.turn+1,this.turnClosure(),this.turnFlag=this.checkCollision(!0)):this.turn=this.directionPriority?this.turn-1:this.turn+1,this.turnClosure())}turnClosure(){this.turn<n.right&&(this.turn=n.top),this.turn>n.top&&(this.turn=n.right)}turnGun(t){let i=Math.round(this.map.unitWidth/2),s=Math.round(this.map.unitWidth/2),e=t.pos.coords.X+Math.round(this.map.unitWidth/2),r=t.pos.coords.Y+Math.round(this.map.unitWidth/2),u=this.pos.coords.X+i,a=(r-(this.pos.coords.Y+s))/(e-u);this.gun.degree=u<=e?180*Math.atan(a)/Math.PI:180*Math.atan(a)/Math.PI+180}shot(){this.counter++;let t=null;for(let i of this.targets)if(this.uc.health>0&&i.uc.health>0&&this.searchTarget(i)){t=i;break}null!==t&&(this.turnGun(t),this.trigger=!0),this.trigger&&(this.counter%2==0&&this.reload===this.bullet.speed&&this.bullet.move(),this.counter%2==0&&this.reload++,this.kill=this.bullet.fatalHit(),null!==this.kill&&(++this.kills,++this.killsInGame,this.bullet.target=null,this.levelUp(),this.kill=null),this.reload>10&&(this.trigger=!1,this.bullet.hit=!1,this.bullet.hitMiss=!1,this.reload=0))}}class E extends class{constructor(d,t,i){h(this,"renderX",0),h(this,"renderY",0),h(this,"deltaWidth",0),h(this,"deltaHeight",0),h(this,"unitWidth",0),h(this,"unitPerim",0),h(this,"baseWidth",280),h(this,"frontWidth",0),h(this,"frontHeight",0),h(this,"backWidth",0),h(this,"backHeight",0),h(this,"barrier",1e3),this.canvas=d,this.mapImg=t,this.unitWidth=i.width,this.unitPerim=4*i.width,this.frontWidth=t.width,this.frontHeight=t.height,this.backWidth=this.frontWidth+2*this.barrier,this.backHeight=this.frontHeight+2*this.barrier}calculateDelta(){this.deltaWidth=this.frontWidth-this.canvas.width,this.deltaHeight=this.frontHeight-this.canvas.height}moveMap(d,t){this.calculateDelta(),d<=10&&this.renderX>0?this.renderX-=10:this.renderX<0&&(this.renderX=0),t<=10&&this.renderY>0?this.renderY-=10:this.renderY<0&&(this.renderY=0),d>=this.canvas.width-10&&this.renderX<this.deltaWidth?this.renderX+=10:this.renderX>this.deltaWidth&&(this.renderX=this.deltaWidth),t>=this.canvas.height-10&&this.renderY<this.deltaHeight?this.renderY+=10:this.renderY>this.deltaHeight&&(this.renderY=this.deltaHeight)}}{constructor(t,i,s){super(t,i,s),h(this,"unitsCount",8),h(this,"towersCount",18),h(this,"mobsCount",6),h(this,"backArray",[]),h(this,"unitsCoords",[]),h(this,"startUnitsTurn",[]),h(this,"baseTowers",[]),h(this,"towers",[]),h(this,"mobs",[]),h(this,"etalonMobs",[]),h(this,"redBase",null),h(this,"blueBase",null),h(this,"etalonTower",null),h(this,"backId",null),this.backId=new D(this.unitsCount,this.towersCount,this.mobsCount);const e={model:"gun_1",degree:0},r={model:"gun_3",degree:0},u={model:"gun_5",degree:0};this.redBase=new b("Red","",200,0),this.redBase.tower1=new b("Red","tower_1",100,0,0,3,350,0,_.cloneDeep(e)),this.redBase.tower2=new b("Red","tower_1",100,0,0,3,350,0,_.cloneDeep(e)),this.blueBase=new b("Blue","",200,0),this.blueBase.tower1=new b("Blue","tower_2",100,0,0,3,350,0,_.cloneDeep(r)),this.blueBase.tower2=new b("Blue","tower_2",100,0,0,3,350,0,_.cloneDeep(r)),this.etalonTower=new b("","",100,0,0,3,350),Math.round(2*this.unitWidth/3);const c=Math.round(this.unitWidth/3),a=Math.round(this.unitWidth/2);this.unitsCoords=[new l(3*this.unitWidth-a,this.frontHeight-12*this.unitWidth-a),new l(3*this.unitWidth-a,this.frontHeight-9*this.unitWidth-a),new l(9*this.unitWidth-a,this.frontHeight-3*this.unitWidth-a),new l(12*this.unitWidth-a,this.frontHeight-3*this.unitWidth-a),new l(this.frontWidth-3*this.unitWidth-a,this.frontHeight-13*this.unitWidth+a),new l(this.frontWidth-3*this.unitWidth-a,this.frontHeight-10*this.unitWidth+a),new l(this.frontWidth-9*this.unitWidth-a,this.frontHeight-3*this.unitWidth-a),new l(this.frontWidth-12*this.unitWidth-a,this.frontHeight-3*this.unitWidth-a)],this.startUnitsTurn=[n.right,n.right,n.top,n.top,n.left,n.left,n.top,n.top],this.baseTowers=[this.redBase.tower1,this.redBase.tower2,this.blueBase.tower1,this.blueBase.tower2],this.redBase.tower1.pos.coords=new l(9*this.unitWidth+a,10*this.unitWidth+a),this.redBase.tower2.pos.coords=new l(9*this.unitWidth+a,15*this.unitWidth+a),this.blueBase.tower1.pos.coords=new l(this.frontWidth-11*this.unitWidth+a,9*this.unitWidth+a),this.blueBase.tower2.pos.coords=new l(this.frontWidth-11*this.unitWidth+a,14*this.unitWidth+a);for(let m=0;m<9;++m)this.towers.push(new b("Red","tower_1",100,0,0,3,350,0,_.cloneDeep(e)));for(let m=0;m<9;++m)this.towers.push(new b("Blue","tower_2",100,0,0,3,350,0,_.cloneDeep(r)));this.towersCoords=[new l(16*this.unitWidth,8*this.unitWidth),new l(15*this.unitWidth,4*this.unitWidth),new l(17*this.unitWidth,14*this.unitWidth),new l(17*this.unitWidth,18*this.unitWidth),new l(16*this.unitWidth,24*this.unitWidth+c),new l(15*this.unitWidth,28*this.unitWidth+c),new l(27*this.unitWidth,2*this.unitWidth),new l(28*this.unitWidth,15*this.unitWidth),new l(27*this.unitWidth,this.frontHeight-3*this.unitWidth),new l(this.frontWidth-16*this.unitWidth,4*this.unitWidth),new l(this.frontWidth-17*this.unitWidth,8*this.unitWidth),new l(this.frontWidth-18*this.unitWidth,14*this.unitWidth),new l(this.frontWidth-18*this.unitWidth,18*this.unitWidth),new l(this.frontWidth-17*this.unitWidth,24*this.unitWidth+c),new l(this.frontWidth-16*this.unitWidth,28*this.unitWidth+c),new l(this.frontWidth-28*this.unitWidth,2*this.unitWidth),new l(this.frontWidth-29*this.unitWidth,17*this.unitWidth),new l(this.frontWidth-28*this.unitWidth,this.frontHeight-3*this.unitWidth)];for(let m=0;m<6;++m)this.mobs.push(new b("Green","tower_3",15,0,0,3,250,1e3,_.cloneDeep(u))),this.etalonMobs.push(new b("Green","tower_3",15,0,0,3,250,1e3,_.cloneDeep(u)));this.mobsCoords=[new l(24*this.unitWidth+a,10*this.unitWidth+a),new l(24*this.unitWidth+a,21*this.unitWidth),new l(23*this.unitWidth+a,24*this.unitWidth+a),new l(this.frontWidth-25*this.unitWidth-a,9*this.unitWidth+a),new l(this.frontWidth-25*this.unitWidth-a,20*this.unitWidth),new l(this.frontWidth-24*this.unitWidth-a,24*this.unitWidth)],this.mapInit()}mapInit(){const t=Math.round(2*this.unitWidth/3),i=Math.round(this.unitWidth/3);this.backArray.push(new o(0,0,7*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(0,this.frontHeight-8*this.unitWidth,4*this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(4*this.unitWidth,this.frontHeight-6*this.unitWidth,this.unitWidth,6*this.unitWidth,this.backId.wall)),this.backArray.push(new o(5*this.unitWidth,this.frontHeight-5*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(6*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(0,5*this.unitWidth,2*this.unitWidth,this.frontHeight-8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-11*this.unitWidth,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(2*this.unitWidth,5*this.unitWidth,2*this.unitWidth,15*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(7*this.unitWidth,0,22*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,2*this.unitWidth,10*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(8*this.unitWidth,this.frontHeight-2*this.unitWidth,21*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,this.frontHeight-4*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(13*this.unitWidth,this.frontHeight-3*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(13*this.unitWidth,this.frontHeight-4*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(17*this.unitWidth,9*this.unitWidth,4*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(20*this.unitWidth,6*this.unitWidth,6*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,7*this.unitWidth,this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,7*this.unitWidth,2*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,12*this.unitWidth,2*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(25*this.unitWidth,10*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(28*this.unitWidth,6*this.unitWidth,this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(28*this.unitWidth,11*this.unitWidth,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(17*this.unitWidth,this.frontHeight-14*this.unitWidth-i,4*this.unitWidth,5*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-14*this.unitWidth-i,3*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-13*this.unitWidth-i,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,this.frontHeight-10*this.unitWidth-i,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(25*this.unitWidth,this.frontHeight-13*this.unitWidth-i,this.unitWidth,3*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(25*this.unitWidth,this.frontHeight-9*this.unitWidth-i,this.unitWidth,3*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(20*this.unitWidth,this.frontHeight-7*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-9*this.unitWidth-i,this.unitWidth,2*this.unitWidth+i,this.backId.closeRoad)),this.backArray.push(new o(28*this.unitWidth,this.frontHeight-15*this.unitWidth-i,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(28*this.unitWidth,this.frontHeight-9*this.unitWidth-i,this.unitWidth,3*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(this.frontWidth-7*this.unitWidth,0,7*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-8*this.unitWidth,4*this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-5*this.unitWidth,this.frontHeight-6*this.unitWidth,this.unitWidth,6*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-6*this.unitWidth,this.frontHeight-5*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-8*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-2*this.unitWidth,5*this.unitWidth,2*this.unitWidth,20*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-11*this.unitWidth,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,5*this.unitWidth,2*this.unitWidth,15*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,0,22*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-20*this.unitWidth,2*this.unitWidth,10*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-18*this.unitWidth,3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-2*this.unitWidth,21*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,this.frontHeight-3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-18*this.unitWidth,this.frontHeight-4*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,this.frontHeight-4*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,9*this.unitWidth,4*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,6*this.unitWidth,6*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,7*this.unitWidth,3*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,9*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,11*this.unitWidth,3*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,9*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,6*this.unitWidth,this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,11*this.unitWidth,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,this.frontHeight-14*this.unitWidth-i,4*this.unitWidth,5*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-15*this.unitWidth-i,3*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,this.frontHeight-14*this.unitWidth-i,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-11*this.unitWidth-i,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-10*this.unitWidth-i,this.unitWidth,4*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(this.frontWidth-25*this.unitWidth,this.frontHeight-7*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-14*this.unitWidth-i,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,this.frontHeight-10*this.unitWidth-i,this.unitWidth,3*this.unitWidth+i,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-15*this.unitWidth-i,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-9*this.unitWidth-i,this.unitWidth,3*this.unitWidth+i,this.backId.wall)),this.backArray.push(new o(29*this.unitWidth,0,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,6*this.unitWidth,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,11*this.unitWidth,8*this.unitWidth+t,4*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,18*this.unitWidth,8*this.unitWidth+t,4*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,24*this.unitWidth,8*this.unitWidth+t,3*this.unitWidth+i,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,30*this.unitWidth+i,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,9*this.unitWidth,9*this.unitWidth+t,2*this.unitWidth,this.backId.sand)),this.backArray.push(new o(29*this.unitWidth,22*this.unitWidth,9*this.unitWidth+t,2*this.unitWidth,this.backId.sand)),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-13*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[0])),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-10*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[1])),this.backArray.push(new o(8*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[2])),this.backArray.push(new o(11*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[3])),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-13*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[4])),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-10*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[5])),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[6])),this.backArray.push(new o(this.frontWidth-13*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[7])),this.backArray.push(new o(7*this.unitWidth,2*this.unitWidth,3*this.unitWidth,3*this.unitWidth-20,this.backId.hpRegenRed)),this.backArray.push(new o(4*this.unitWidth,5*this.unitWidth,3*this.unitWidth-20,3*this.unitWidth,this.backId.cpRegen)),this.backArray.push(new o(this.frontWidth-7*this.unitWidth+20,5*this.unitWidth,3*this.unitWidth-20,3*this.unitWidth,this.backId.cpRegen)),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,2*this.unitWidth,3*this.unitWidth,3*this.unitWidth-20,this.backId.hpRegenBlue)),this.backArray.push(new o(4*this.unitWidth,11*this.unitWidth,6*this.unitWidth,5*this.unitWidth,this.backId.redBase)),this.backArray.push(new o(4*this.unitWidth,10*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(10*this.unitWidth,11*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(4*this.unitWidth,16*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,10*this.unitWidth,6*this.unitWidth,5*this.unitWidth,this.backId.blueBase)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,9*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,10*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,15*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad))}}class S{constructor(){h(this,"images",new Map([["testGameMap",new Image(4e3,2e3)],["bullet_1",new Image(60,60)],["bullet_1_shot",new Image(60,60)],["bullet_1_boom",new Image(60,60)],["T_1",new Image(60,60)],["T_2",new Image(60,60)],["T_3",new Image(60,60)],["T_4",new Image(60,60)],["tower_1",new Image(60,60)],["tower_2",new Image(60,60)],["tower_3",new Image(60,60)],["gun_1",new Image(60,60)],["gun_2",new Image(60,60)],["gun_3",new Image(60,60)],["gun_4",new Image(60,60)],["gun_5",new Image(60,60)],["redCrash",new Image(60,60)],["blueCrash",new Image(60,60)],["smoke_1",new Image(60,60)]])),h(this,"counter",0);const t=k===f.Dev?"../../":"";this.images.get("testGameMap").src=`${t}images/testGame/map_1.png`,this.images.get("bullet_1").src=`${t}images/testGame/bullet_1.png`,this.images.get("bullet_1_shot").src=`${t}images/testGame/bullet_1_shot.png`,this.images.get("bullet_1_boom").src=`${t}images/testGame/bullet_1_boom.png`,this.images.get("T_1").src=`${t}images/testGame/T_1.png`,this.images.get("T_2").src=`${t}images/testGame/T_2.png`,this.images.get("T_3").src=`${t}images/testGame/T_3.png`,this.images.get("T_4").src=`${t}images/testGame/T_4.png`,this.images.get("tower_1").src=`${t}images/testGame/tower_1.png`,this.images.get("tower_2").src=`${t}images/testGame/tower_2.png`,this.images.get("tower_3").src=`${t}images/testGame/tower_3.png`,this.images.get("gun_1").src=`${t}images/testGame/gun_1.png`,this.images.get("gun_2").src=`${t}images/testGame/gun_2.png`,this.images.get("gun_3").src=`${t}images/testGame/gun_3.png`,this.images.get("gun_4").src=`${t}images/testGame/gun_4.png`,this.images.get("gun_5").src=`${t}images/testGame/gun_5.png`,this.images.get("redCrash").src=`${t}images/testGame/redCrash.png`,this.images.get("blueCrash").src=`${t}images/testGame/blueCrash.png`,this.images.get("smoke_1").src=`${t}images/testGame/smoke_1.png`}allUploaded(t){let i=()=>{++this.counter===this.images.size&&t()};this.images.forEach(s=>{s.onload=i})}}class L{constructor(t,i,s,e,r,u){h(this,"sounds",new Map),h(this,"counter",0);const c=k===f.Dev?"../../":"";e.forEach(a=>{this.sounds.set(a.id,a.id===s.id?new Audio(`${c}sounds/ShotLoud.mp3`):new Audio(`${c}sounds/ShotQuit.mp3`))}),r.forEach(a=>{this.sounds.set(a.id,new Audio(`${c}sounds/ShotQuit.mp3`))}),u.forEach(a=>{this.sounds.set(a.id,new Audio(`${c}sounds/ShotQuit.mp3`))}),this.sounds.set(t.tower1.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(t.tower2.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(i.tower1.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(i.tower2.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set("Wind",new Audio(`${c}sounds/Wind.mp3`))}}class ${constructor(t,i,s){h(this,"map",null),h(this,"uI",0),h(this,"etalonUnits",[]),h(this,"cloneUnits",[]),this.map=t,this.etalonUnits=i,this.userId=s,this.uI=this.findUser(),this.preparation(),this.counter=0,this.pause=!1,this.defeat=!1,this.win=!1,this.bonus=0}findUser(){for(let t=0;t<this.etalonUnits.length;++t)if(this.userId===this.etalonUnits[t].userId)return t}preparation(){this.etalonUnits.forEach((t,i)=>{t.pos.coords.X=this.map.unitsCoords[i].X,t.pos.coords.Y=this.map.unitsCoords[i].Y,t.turn=this.map.startUnitsTurn[i],t.id=this.map.backId.units[i],t.homeId=this.map.backId.homes[i],t.gun.degree=90*t.turn,this.cloneUnits[i]=_.cloneDeep(t),this.cloneUnits[i].map=t.map=this.map,this.cloneUnits[i].width=this.cloneUnits[i].height=this.map.unitWidth,this.cloneUnits[i].bullet.map=t.bullet.map=this.map,this.cloneUnits[i].bullet.width=this.cloneUnits[i].bullet.height=Math.round(this.map.unitWidth/5),this.map.backArray.push(this.cloneUnits[i]),this.userId===t.userId&&(this.cloneUnits[i].control=t.control,this.cloneUnits[i].control.mouseMove(),this.cloneUnits[i].control.mouseDown(),this.cloneUnits[i].control.mouseUp(),this.cloneUnits[i].control.keyDown(),this.cloneUnits[i].control.keyUp())}),this.map.towers.forEach((t,i)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.towers[i],t.pos.coords=this.map.towersCoords[i],t.turn="blue"===t.side?n.left:n.right,t.gun.degree="blue"===t.side?180:0,t.targets=this.cloneUnits.filter(s=>t.side!==s.side),t.allies=this.cloneUnits.filter(s=>t.side===s.side),t.width=t.height=this.map.unitWidth,this.map.backArray.push(t),t.update(t.pos.coords)}),this.map.mobs.forEach((t,i)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.mobs[i],t.pos.coords=this.map.mobsCoords[i],t.targets=this.cloneUnits.filter(s=>t.side!==s.side),t.allies=this.cloneUnits.filter(s=>t.side===s.side),t.width=t.height=this.map.unitWidth,this.map.backArray.push(t),t.update(t.pos.coords)}),this.map.etalonMobs.forEach((t,i)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.mobs[i],t.pos.coords=this.map.mobsCoords[i],t.targets=this.cloneUnits.filter(s=>t.side!==s.side),t.allies=this.cloneUnits.filter(s=>t.side===s.side)}),this.cloneUnits.forEach(t=>{t.targets=this.cloneUnits.filter(i=>t.side!==i.side),this.map.towers.filter(i=>t.side!==i.side).forEach(i=>{t.targets.push(i)}),this.map.mobs.filter(i=>t.side!==i.side).forEach(i=>{t.targets.push(i)}),t.targets.push("red"===t.side?this.map.blueBase:this.map.redBase),t.allies=this.cloneUnits.filter(i=>t.side===i.side)}),this.map.baseTowers.forEach(t=>{t.map=this.map,t.bullet.map=this.map,t.targets=this.cloneUnits.filter(i=>t.side!==i.side),t.allies=this.cloneUnits.filter(i=>t.side===i.side)}),this.map.redBase.id=this.map.backId.redBase,this.map.blueBase.id=this.map.backId.blueBase,this.map.redBase.tower1.id=1e3,this.map.blueBase.tower2.id=1001,this.map.blueBase.tower1.id=1002,this.map.blueBase.tower2.id=1003,this.sound=new L(this.map.redBase,this.map.blueBase,this.cloneUnits[this.uI],this.cloneUnits,this.map.towers,this.map.mobs)}unitsBackFill(){this.cloneUnits.forEach(t=>{t.pos.pastCoords.X=t.pos.coords.X,t.pos.pastCoords.Y=t.pos.coords.Y,t.update(t.pos.coords),t.checkFrontWay(1)})}run(){"Space"===this.cloneUnits[this.uI].control.buttonUp&&(this.pause=!1===this.pause,this.cloneUnits[this.uI].control.buttonUp=""),!this.pause&&!this.win&&!this.defeat&&(this.counter++,this.counter>5400&&(this.counter=0),this.unitsBackFill(),this.cloneUnits.forEach((t,i)=>{this.uI!==i&&(this.botLogic(t),null!==t.target&&t.hunt(t.target),t.shot(),this.crash(t,this.etalonUnits[i]),this.rebirth(t,this.etalonUnits[i]))}),this.map.baseTowers.forEach(t=>{t.shot()}),this.map.towers.forEach(t=>{t.shot()}),this.map.mobs.forEach((t,i)=>{t.uc.health<t.etalonUc.health&&t.shot(),this.crash(t,this.map.etalonMobs[i]),this.rebirth(t,this.map.etalonMobs[i])}),this.cloneUnits[this.uI].controlHandling(),this.cloneUnits[this.uI].shot(),this.crash(this.cloneUnits[this.uI],this.etalonUnits[this.uI]),this.rebirth(this.cloneUnits[this.uI],this.etalonUnits[this.uI]),this.gameOver())}gameOver(){"red"===this.cloneUnits[this.uI].side&&this.map.blueBase.uc.health<=0||"blue"===this.cloneUnits[this.uI].side&&this.map.redBase.uc.health<=0?(++this.etalonUnits[this.uI].wins,++this.etalonUnits[this.uI].battles,this.etalonUnits[this.uI].kills=this.cloneUnits[this.uI].kills,this.bonus=y(500,1e3),this.etalonUnits[this.uI].money+=this.bonus,this.win=!0):("red"===this.cloneUnits[this.uI].side&&this.map.redBase.uc.health<=0||"blue"===this.cloneUnits[this.uI].side&&this.map.blueBase.uc.health<=0)&&(++this.etalonUnits[this.uI].defeats,++this.etalonUnits[this.uI].battles,this.etalonUnits[this.uI].kills=this.cloneUnits[this.uI].kills,this.bonus=y(200,300),this.etalonUnits[this.uI].money+=this.bonus,this.defeat=!0)}botLogic(t){var i;if(this.counter%1200==0||1===this.counter||null===t.target||t.target.uc.health<=0){let s=new Map;t.targets.forEach((u,c)=>{let a=Math.abs(u.pos.coords.X-t.pos.coords.X),m=Math.abs(u.pos.coords.Y-t.pos.coords.Y);s.set(u,Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(m,2))))});const e=[...s.entries()].sort((u,c)=>u[1]-c[1]).map(([u,c])=>u).filter(u=>!t.allies.find(c=>{var a;return(null==(a=c.target)?void 0:a.id)===u.id}));let r=!1;for(let u of e){for(let c of t.allies){if((null==(i=c.target)?void 0:i.id)===u.id)break;if(u.uc.health>0){t.target=u,r=!0;break}}if(r)break}}}crash(t,i){t.uc.health<=0&&t.uc.respawnTime===t.etalonUc.respawnTime&&(t.pos.crashCoords.X=t.pos.coords.X,t.pos.crashCoords.Y=t.pos.coords.Y,t.turn=i.turn,t.gun.degree=i.gun.degree,t.pos.coords.X=i.pos.coords.X,t.pos.coords.Y=i.pos.coords.Y),t.uc.health<=0&&--t.uc.respawnTime}rebirth(t){t.uc.respawnTime<=0&&(t.uc.respawnTime=t.etalonUc.respawnTime,t.uc.armor=t.etalonUc.armor,t.uc.health=t.etalonUc.health)}}class G extends M{constructor(t,i,s){super(),h(this,"experienceToLevel",0),h(this,"money",0),h(this,"battles",0),h(this,"wins",0),h(this,"kills",0),h(this,"killsInGame",0),h(this,"defeats",0),h(this,"counter",0),h(this,"control",null),h(this,"name","Player"),super.userId=i,super.side=s.team.toLowerCase(),this.control=t,this.uc.model=s.tankBody,this.etalonUc.model=s.tankBody,this.gun.model=s.tankHead}checkCollision(t){let i=!1;for(let r=this.speedController;r>0&&(i=!1,this.setPosition(r,!0),this.checkFrontWay(r)||(this.setPosition(r,!1),i=!0),!1!==i);r--);let e=this.pos.coords.Y-this.pos.pastCoords.Y;if(this.pos.deltaCoords.X=this.pos.coords.X-this.pos.pastCoords.X,this.pos.deltaCoords.Y=e,t&&!i){let u=this.pos.renderCoords.Y+this.pos.deltaCoords.Y;this.pos.renderCoords.X=this.pos.renderCoords.X+this.pos.deltaCoords.X,this.pos.renderCoords.Y=u}}shot(){!0===this.trigger&&(this.counter%2==0&&this.reload===this.bullet.speed&&this.bullet.move(),this.counter%2==0&&this.reload++,this.kill=this.bullet.fatalHit(),null!==this.kill&&(++this.kills,++this.killsInGame,this.bullet.target=null,this.levelUp(),this.kill=null),this.reload>10&&(this.trigger=!1,this.bullet.hit=!1,this.bullet.hitMiss=!1,this.reload=0))}extraMove(t){this.uc.health>0&&(this.speedController<this.uc.speed&&this.counter%2==0&&++this.speedController,this.checkCollision(t))}checkMapSides(){let t=this.map.renderY>=this.uc.speed,i=this.pos.coords.Y<=this.map.frontHeight-Math.floor(this.control.canvas.height/2),s=this.map.renderY<=this.map.frontHeight-this.control.canvas.height-this.uc.speed,e=this.pos.coords.Y>=Math.floor(this.control.canvas.height/2),r=this.map.renderX>=this.uc.speed,u=this.pos.coords.X<=this.map.frontWidth-Math.floor(this.control.canvas.width/2),c=this.map.renderX<=this.map.frontWidth-this.control.canvas.width-this.uc.speed,a=this.pos.coords.X>=Math.floor(this.control.canvas.width/2);return this.turn===n.top?t&&i:this.turn===n.bottom?s&&e:this.turn===n.left?r&&u:this.turn===n.right?c&&a:void 0}correctRenderCoords1(){this.map.renderX-=this.pos.deltaCoords.X,this.map.renderY-=this.pos.deltaCoords.Y,this.targets.forEach(t=>{t.bullet.pos.renderCoords.X+=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y+=this.pos.deltaCoords.Y}),this.allies.forEach(t=>{t.bullet.pos.renderCoords.X+=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y+=this.pos.deltaCoords.Y})}correctRenderCoords2(){this.map.renderX+=this.pos.deltaCoords.X,this.map.renderY+=this.pos.deltaCoords.Y,this.targets.forEach(t=>{t.bullet.pos.renderCoords.X-=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y-=this.pos.deltaCoords.Y}),this.allies.forEach(t=>{t.bullet.pos.renderCoords.X-=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y-=this.pos.deltaCoords.Y})}move(t){this.checkMapSides()?(t(!1),this.pos.deltaCoords.X<0||this.pos.deltaCoords.Y<0?this.turn===n.right||this.turn===n.bottom?this.correctRenderCoords1():this.correctRenderCoords2():this.turn===n.right||this.turn===n.bottom?this.correctRenderCoords2():this.correctRenderCoords1()):t(!0)}turnGun(){let t=Math.round(this.map.unitWidth/2),i=Math.round(this.map.unitWidth/2),s=this.pos.renderCoords.X+t,r=(this.control.mouseY-(this.pos.renderCoords.Y+i))/(this.control.mouseX-s);this.gun.degree=s<this.control.mouseX?180*Math.atan(r)/Math.PI:180*Math.atan(r)/Math.PI+180}controlHandling(){if(this.uc.health>0)switch(this.turnGun(),this.counter++,this.counter>1e3&&(this.counter=0),this.control.buttonDown){case"ArrowUp":case"KeyW":this.turn=n.top,this.move(t=>this.extraMove(t));break;case"ArrowDown":case"KeyS":this.turn=n.bottom,this.move(t=>this.extraMove(t));break;case"ArrowLeft":case"KeyA":this.turn=n.left,this.move(t=>this.extraMove(t));break;case"ArrowRight":case"KeyD":this.turn=n.right,this.move(t=>this.extraMove(t));break;default:this.speedController>0&&this.counter%4==0&&""!==this.control.buttonUp&&(--this.speedController,this.move(t=>this.checkCollision(t)))}""!==this.control.buttonUp&&(this.control.buttonDown=""),this.control.checkMouseDown&&this.uc.health>0&&(this.trigger=!0),this.control.checkMouseUp&&(this.control.checkMouseDown=!1,this.control.checkMouseUp=!1)}}class F{constructor(t,i,s,e){h(this,"pic",null),h(this,"canvas",null),h(this,"context",null),h(this,"map",null),h(this,"etalonUnits",[]),h(this,"cloneUnits",[]),h(this,"uI",0),h(this,"game",null),this.game=e,this.map=e.map,this.pic=t,this.canvas=i,this.context=s,this.etalonUnits=e.etalonUnits,this.cloneUnits=e.cloneUnits,this.userId=e.userId,this.uI=e.uI,this.crashDegrees=0,this.userPreparation(),this.othersPreparation()}userPreparation(){let t=Math.round(this.canvas.width/2),i=Math.round(this.canvas.height/2),a=this.cloneUnits[this.uI].pos.coords.Y+i>=this.map.frontHeight?this.map.frontHeight-this.cloneUnits[this.uI].pos.coords.Y:i;this.cloneUnits[this.uI].pos.coords.X>=this.canvas.width?(this.map.renderX=this.cloneUnits[this.uI].pos.coords.X+(this.cloneUnits[this.uI].pos.coords.X+t>=this.map.frontWidth?this.map.frontWidth-this.cloneUnits[this.uI].pos.coords.X:t)-this.canvas.width,this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX,this.etalonUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX):(this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X,this.etalonUnits[this.uI].pos.renderCoords.X=this.etalonUnits[this.uI].pos.coords.X),this.cloneUnits[this.uI].pos.coords.Y>this.canvas.height?(this.map.renderY=this.cloneUnits[this.uI].pos.coords.Y+a-this.canvas.height,this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY,this.etalonUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY):(this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y,this.etalonUnits[this.uI].pos.renderCoords.Y=this.etalonUnits[this.uI].pos.coords.Y)}othersPreparation(){for(let t=0;t<this.cloneUnits.length;++t)t!==this.uI&&(this.cloneUnits[t].pos.renderCoords.X=this.cloneUnits[t].pos.coords.X-this.cloneUnits[this.uI].map.renderX,this.cloneUnits[t].pos.renderCoords.Y=this.cloneUnits[t].pos.coords.Y-this.map.renderY,this.cloneUnits[t].bullet.pos.renderCoords.X=this.cloneUnits[t].bullet.pos.coords.X-this.map.renderX,this.cloneUnits[t].bullet.pos.renderCoords.Y=this.cloneUnits[t].bullet.pos.coords.Y-this.map.renderY);this.map.baseTowers.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.towers.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.mobs.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.redBase.pos.renderCoords.X=4*this.map.unitWidth-this.map.renderX,this.map.redBase.pos.renderCoords.Y=11*this.map.unitWidth-this.map.renderY,this.map.blueBase.pos.renderCoords.X=this.map.frontWidth-4*this.map.unitWidth-this.map.renderX,this.map.blueBase.pos.renderCoords.Y=10*this.map.unitWidth-this.map.renderY}showUnitModel(t){let i=0;t.turn===n.right&&(i=0),t.turn===n.bottom&&(i=90),t.turn===n.left&&(i=180),t.turn===n.top&&(i=270),this.rotateImage(i,this.map.unitWidth,this.map.unitWidth,t.pos.renderCoords,()=>{this.context.drawImage(this.pic.images.get(t.uc.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}),this.showGunModel(t)}showGunModel(t){t.uc.health>0&&this.rotateImage(t.gun.degree,this.map.unitWidth,this.map.unitWidth,t.pos.renderCoords,()=>{this.context.drawImage(this.pic.images.get(t.gun.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))})}rotateImage(t,i,s,e,r){this.context.save(),this.context.translate(e.X+Math.floor(i/2),e.Y+Math.floor(s/2)),this.context.rotate(t*(Math.PI/180)),r(),this.context.restore()}showShot(t){this.showBullet(t.bullet.degree,t),this.showShotMoment(t.bullet.degree,t),this.showBoomMoment(t.bullet.degree,t)}showBullet(t,i){if(1===i.bullet.speed&&(this.game.sound.sounds.get(i.id).currentTime=0,this.game.sound.sounds.get(i.id).play()),0!==i.bullet.speed){let s=this.pic.images.get(i.ammunition[i.bulletType].model);this.rotateImage(t,s.width,s.height,i.bullet.pos.renderCoords,()=>{this.context.drawImage(s,-Math.floor(s.width/2),-Math.floor(s.height/2))})}}showShotMoment(t,i){if(2===i.bullet.speed||3===i.bullet.speed){let s=this.pic.images.get(i.ammunition[i.bulletType].shot_model);2===i.bullet.speed&&(i.bullet.bulletType.shot_coords.X=i.bullet.pos.renderCoords.X,i.bullet.bulletType.shot_coords.Y=i.bullet.pos.renderCoords.Y),this.rotateImage(t,s.width,s.height,i.bullet.bulletType.shot_coords,()=>{this.context.drawImage(s,-Math.floor(s.width/2),-Math.floor(s.height/2))})}}showBoomMoment(t,i){if(i.bullet.hit||i.bullet.hitMiss){let s=this.pic.images.get(i.ammunition[i.bulletType].boom_model);i.bullet.bulletType.boom_coords.X=i.bullet.pos.renderCoords.X,i.bullet.bulletType.boom_coords.Y=i.bullet.pos.renderCoords.Y,this.rotateImage(t,s.width,s.height,i.bullet.bulletType.boom_coords,()=>{this.context.drawImage(s,-Math.floor(s.width/2),-Math.floor(s.height/2))})}}healthArmorBalancer(t,i,s){return t*s/i}showArmor(t){if(t.uc.health>0){const i=this.map.unitWidth-20+3;this.context.fillStyle="darkOrange";let s=this.healthArmorBalancer(t.uc.armor,t.etalonUc.armor,i);switch(t.turn){case n.right:this.context.fillRect(t.pos.renderCoords.X-28,t.pos.renderCoords.Y+20+i-s,4,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-28,t.pos.renderCoords.Y+20,4,i-s);break;case n.bottom:this.context.fillRect(t.pos.renderCoords.X-3+i-s,t.pos.renderCoords.Y-28,s,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y-28,i-s,4);break;case n.left:this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+28-4,t.pos.renderCoords.Y+20+i-s,4,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+28-4,t.pos.renderCoords.Y+20,4,i-s);break;case n.top:this.context.fillRect(t.pos.renderCoords.X-3+i-s,t.pos.renderCoords.Y+this.map.unitWidth+28-4,s,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y+this.map.unitWidth+28-4,i-s,4)}}}showHealth(t){if(t.uc.health>0){const i=this.map.unitWidth-20+3;this.context.fillStyle="red"===t.side?"darkRed":"green"===t.side?"darkGreen":"blue";let s=this.healthArmorBalancer(t.uc.health,t.etalonUc.health,i);switch(t.turn){case n.right:this.context.fillRect(t.pos.renderCoords.X-24,t.pos.renderCoords.Y+20+i-s,4,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-24,t.pos.renderCoords.Y+20,4,i-s);break;case n.bottom:this.context.fillRect(t.pos.renderCoords.X-3+i-s,t.pos.renderCoords.Y-24,s,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y-24,i-s,4);break;case n.left:this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+24-4,t.pos.renderCoords.Y+20+i-s,4,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+24-4,t.pos.renderCoords.Y+20,4,i-s);break;case n.top:this.context.fillRect(t.pos.renderCoords.X-3+i-s,t.pos.renderCoords.Y+this.map.unitWidth+24-4,s,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y+this.map.unitWidth+24-4,i-s,4)}}}showLevel(t){if(t.uc.health>0){this.context.save(),this.context.fillStyle="rgb(255, 255, 255)",this.context.font="16px Arial";const i=30;switch(t.turn){case n.right:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X-i-2+20.5,t.pos.renderCoords.Y-3+9),this.context.rotate(270*Math.PI/180);break;case n.bottom:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X+this.map.unitWidth+3-9,t.pos.renderCoords.Y-i-2+20.5);break;case n.left:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X+this.map.unitWidth+(i-25-2)+12.5+8,t.pos.renderCoords.Y-3+9),this.context.rotate(270*Math.PI/180);break;case n.top:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X+this.map.unitWidth+3-9,t.pos.renderCoords.Y+this.map.unitWidth+(i-25-2)+12.5+8)}this.context.fillText(`${t.uc.level}`,0,0,21),this.context.restore()}}showName(t){if(t.uc.health>0){const i=3+this.map.unitWidth-18;this.context.save(),this.context.fillStyle="rgb(255, 255, 255)",this.context.strokeStyle="rgb(255, 255, 255)",this.context.font="100 13px Arial";const s=30;switch(t.turn){case n.right:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X-s-2+25,t.pos.renderCoords.Y+this.map.unitWidth+3-1-i/2),this.context.rotate(270*Math.PI/180);break;case n.bottom:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X-3+1+i/2,t.pos.renderCoords.Y-s-2+25);break;case n.left:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X+this.map.unitWidth+s-2-12.5,t.pos.renderCoords.Y+this.map.unitWidth+3-1-i/2),this.context.rotate(270*Math.PI/180);break;case n.top:this.context.textAlign="center",this.context.translate(t.pos.renderCoords.X-3+1+i/2,t.pos.renderCoords.Y+this.map.unitWidth+s-2-12.5)}const e=this.restrictText(this.context,`${t.name}`,0,0,i);this.context.fillText(e,0,0,i),this.context.restore()}}showUCContainer(t){if(t.uc.health>0){const i=this.map.unitWidth+10;let s,e;switch(this.context.save(),this.context.fillStyle="rgba(60, 50, 50, 0.7)",this.context.strokeStyle="rgb(20, 20, 20)",this.context.lineJoin="round",this.context.lineWidth=1,this.context.beginPath(),t.turn){case n.right:s=t.pos.renderCoords.X-30,e=t.pos.renderCoords.Y-5,this.context.roundRect(s,e,25,i,3);break;case n.bottom:s=t.pos.renderCoords.X-5,e=t.pos.renderCoords.Y-30,this.context.roundRect(s,e,i,25,3);break;case n.left:s=t.pos.renderCoords.X+30-25+this.map.unitWidth,e=t.pos.renderCoords.Y-5,this.context.roundRect(s,e,25,i,3);break;case n.top:s=t.pos.renderCoords.X-5,e=t.pos.renderCoords.Y+30-25+this.map.unitWidth,this.context.roundRect(s,e,i,25,3)}this.context.stroke(),this.context.fill(),this.context.restore()}}showBaseHealth(t){if(t.uc.health>0){let i=this.healthArmorBalancer(t.uc.health,t.etalonUc.health,this.map.baseWidth);this.context.fillStyle="red"===t.side?"darkRed":"blue","red"===t.side?(this.context.fillRect(t.pos.renderCoords.X-20,t.pos.renderCoords.Y+this.map.baseWidth-i,12,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-20,t.pos.renderCoords.Y,12,this.map.baseWidth-i)):(this.context.fillRect(t.pos.renderCoords.X+20,t.pos.renderCoords.Y+this.map.baseWidth-i,12,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+20,t.pos.renderCoords.Y,12,this.map.baseWidth-i))}}showCrash(t){t.uc.health<=0&&(t.pos.renderCrashCoords.X=t.pos.crashCoords.X-this.map.renderX,t.pos.renderCrashCoords.Y=t.pos.crashCoords.Y-this.map.renderY,this.rotateImage(0,this.map.unitWidth,this.map.unitWidth,t.pos.renderCrashCoords,()=>{this.context.drawImage(this.pic.images.get(t.uc.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}),++this.crashDegrees,this.rotateImage(this.crashDegrees,this.map.unitWidth,this.map.unitWidth,t.pos.renderCrashCoords,()=>{this.context.drawImage(this.pic.images.get("smoke_1"),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}))}isVisible(t){return!(t.pos.renderCoords.X>this.canvas.width+this.map.unitWidth||t.pos.renderCoords.X<-this.map.unitWidth||t.pos.renderCoords.Y>this.canvas.height+this.map.unitWidth||t.pos.renderCoords.X<-this.map.unitWidth)}render(){if(5===this.game.counter&&(this.game.sound.sounds.get("Wind").currentTime=0,this.game.sound.sounds.get("Wind").play()),this.othersPreparation(),1===this.cloneUnits[this.uI].uc.respawnTime?(this.map.renderX=0,this.map.renderY=0,this.userPreparation()):this.cloneUnits[this.uI].uc.health<=0&&this.map.moveMap(this.cloneUnits[this.uI].control.mouseX,this.cloneUnits[this.uI].control.mouseY),this.context.drawImage(this.map.mapImg,this.map.renderX,this.map.renderY,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height),this.cloneUnits.forEach(t=>{this.showCrash(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showUnitModel(t)}),this.map.towers.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.map.baseTowers.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.map.mobs.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.towers.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.baseTowers.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.mobs.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&(this.showUCContainer(t),this.showName(t),this.showHealth(t),this.showArmor(t),this.showLevel(t))}),this.map.towers.forEach(t=>{this.isVisible(t)&&this.showHealth(t)}),this.map.mobs.forEach(t=>{this.isVisible(t)&&this.showHealth(t)}),this.isVisible(this.map.redBase)&&this.showBaseHealth(this.map.redBase),this.isVisible(this.map.blueBase)&&this.showBaseHealth(this.map.blueBase),this.showUC(),this.game.win||this.game.defeat){this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX,this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY,this.cloneUnits[this.uI].bullet.pos.renderCoords.X=this.cloneUnits[this.uI].bullet.pos.coords.X-this.map.renderX,this.cloneUnits[this.uI].bullet.pos.renderCoords.Y=this.cloneUnits[this.uI].bullet.pos.coords.Y-this.map.renderY,this.map.moveMap(this.cloneUnits[this.uI].control.mouseX,this.cloneUnits[this.uI].control.mouseY),this.context.fillStyle="rgba(60, 50, 50, 0.8)",this.context.strokeStyle="rgb(20, 20, 20)";let t=Math.round(this.canvas.width/10),i=Math.round(this.canvas.height/10),s=8*t,e=8*i,r=20;this.context.lineJoin="round",this.context.lineWidth=r,this.context.strokeRect(t+r/2,i+r/2,s-r,e-r),this.context.fillRect(t+r/2,i+r/2,s-r,e-r),this.game.win&&this.winMessage(i),this.game.defeat&&this.defeatMessage(i)}}showUC(){this.context.fillStyle="rgb(0, 0, 0)",this.context.font="20px Palatino Linotype",this.context.lineWidth=2;let t=20;this.strokedText(`Level: ${this.cloneUnits[this.uI].uc.level}`,t,20),this.strokedText(`Exp: ${Math.floor(this.cloneUnits[this.uI].uc.experience)} / ${Math.floor(this.cloneUnits[this.uI].experienceToLevel)}`,t,40),this.strokedText(`Health: ${Math.floor(this.cloneUnits[this.uI].uc.health)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.health)}`,t,60),this.strokedText(`Armor: ${Math.floor(this.cloneUnits[this.uI].uc.armor)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.armor)}`,t,80),this.strokedText(`Speed: ${Math.floor(this.cloneUnits[this.uI].uc.speed)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.speed)}`,t,100),this.strokedText(`Power: ${Math.floor(this.cloneUnits[this.uI].uc.shotPower)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.shotPower)}`,t,120)}winMessage(t){this.context.textAlign="center";let i=Math.round(this.canvas.width/2);this.context.fillStyle="rgb(255, 255, 255)",this.context.font="48px Palatino Linotype",this.context.lineWidth=5,this.strokedText("PERFECT VICTORY",i,2*t),this.context.font="36px Palatino Linotype",this.context.lineWidth=3,this.strokedText("Congratulations! Your awards / achievements:",i,3*t),this.message(t)}defeatMessage(t){this.context.textAlign="center";let i=Math.round(this.canvas.width/2);this.context.fillStyle="rgb(255, 255, 255)",this.context.font="48px Palatino Linotype",this.context.lineWidth=5,this.strokedText("UNFORTUNATE DEFEAT",i,2*t),this.context.font="36px Palatino Linotype",this.context.lineWidth=3,this.strokedText("Your awards / achievements:",i,3*t),this.message(t)}message(t){let i=Math.round(this.canvas.width/2),s=Math.round(t/2);this.context.lineWidth=3,this.context.font="28px Palatino Linotype",this.strokedText(`Money: +${this.game.bonus}`,i,4*t+s),this.strokedText(`Kills in game: ${this.cloneUnits[this.uI].killsInGame}`,i,4*t+2*s),this.strokedText(`Level in game: ${this.cloneUnits[this.uI].uc.level}`,i,4*t+3*s),this.strokedText(`Total kills: ${this.etalonUnits[this.uI].kills}`,i,4*t+4*s),this.strokedText(`Wins: ${this.etalonUnits[this.uI].wins}`,i,4*t+5*s),this.strokedText(`Defeats: ${this.etalonUnits[this.uI].defeats}`,i,4*t+6*s),this.strokedText(`Battles: ${this.etalonUnits[this.uI].battles}`,i,4*t+7*s)}strokedText(t,i,s,e=this.canvas.width){this.context.strokeText(t,i,s,e),this.context.fillText(t,i,s,e)}restrictText(t,i,s,e,r){const u=i.split("");let c="",a="";for(let m=0;m<u.length;++m)if(a+=u[m],t.measureText(a).width>1.2*r){for(let w=0;w<m;++w)c+=u[w];c+="...";break}return c||(c=i),c}}class O{constructor(t){h(this,"mouseX",0),h(this,"mouseY",0),h(this,"buttonDown",""),h(this,"buttonUp",""),h(this,"checkMouseDown",!1),h(this,"checkMouseUp",!1),this.canvas=t}mouseMove(){this.canvas.addEventListener("mousemove",t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY})}mouseDown(){this.canvas.addEventListener("mousedown",()=>{this.checkMouseDown=!0})}mouseUp(){this.canvas.addEventListener("mouseup",()=>{this.checkMouseUp=!0})}keyDown(){document.addEventListener("keydown",t=>{this.buttonDown=t.code,this.buttonUp=""})}keyUp(){document.addEventListener("keyup",t=>{this.buttonUp=t.code})}}f.Prod===k&&(window._={cloneDeep:null},x(function*(){return window._.cloneDeep=(yield W.e(524).then(W.bind(W,9524)).then(d=>d.i)).default})()),f.Dev===k&&x(function*(){const d=yield W.e(123).then(W.bind(W,4123));document.getElementById("btn0").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest1).run(),document.getElementById("btn1").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest2).run(),document.getElementById("btn2").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest3).run(),document.getElementById("btn3").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest4).run(),document.getElementById("btn4").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest5).run(),document.getElementById("btn5").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest6).run(),document.getElementById("btn6").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest7).run(),document.getElementById("btn7").onclick=()=>new g(document.querySelector("canvas"),new d.DemoSettingsTest8).run()})();class V{constructor(){h(this,"position",0),h(this,"team","red"),h(this,"tankHead","gun_1"),h(this,"tankBody","T_1")}}class g{constructor(t,i=new V){h(this,"map"),h(this,"game"),h(this,"control"),h(this,"units"),h(this,"render"),h(this,"animationFrameRef"),this.canvas=t,this.context=this.canvas.getContext("2d"),this.control=new O(t),this.pictures=new S,this.start=(new Date).getTime(),this.fps=0,this.settings=i}draw(){this.game.run(),setTimeout(()=>this.render.render(),0);let t=(new Date).getTime();this.fps++,t-this.start>=1e3&&(this.start=t,this.fps=0),this.animationFrameRef=requestAnimationFrame(this.draw.bind(this))}run(){this.pictures.allUploaded(()=>{this.map=new E(this.canvas,this.pictures.images.get("testGameMap"),this.pictures.images.get("T_2")),this.canvas.style.cursor=this.pictures.images.get("cursor"),this.units=this.getUnits(),this.game=new $(this.map,this.units,"user"),this.render=new F(this.pictures,this.canvas,this.context,this.game),this.draw()})}getUnits(){const i=()=>new b("Red","T_1",30,30,5,1,200,600,{model:"gun_1",degree:0,coords:new l(0,0)}),s=()=>new b("Blue","T_3",30,30,5,1,200,600,{model:"gun_3",degree:0,coords:new l(0,0)}),e="red"===this.settings.team?this.settings.position:this.settings.position+4,r=[i(),i(),i(),i(),s(),s(),s(),s()];return r.splice(e,1,(()=>new G(this.control,"user",this.settings))()),r}destroy(){this.animationFrameRef&&(cancelAnimationFrame(this.animationFrameRef),Array.from(this.game.sound.sounds.values()).forEach(t=>{t.pause(),t.currentTime=0}))}}var I=W(9865),T=W(9670),p=W(6796),Q=W(3941),z=W(1928),C=W(1588);const N=["demoPanel"],j=["canvas"],K=[{path:"",component:(()=>{class d{constructor(i,s,e){this.demoService=i,this.lsService=s,this.router=e}ngOnInit(){localStorage.getItem(I.$.inDemo)&&this.router.navigate([T.RK.HOME]).then()}onClose(){this.router.navigate([T.RK.HOME]).then()}ngAfterViewInit(){if(!localStorage.getItem(I.$.inDemo)){this.lsService.setItem(I.$.inDemo,"inDemo");const i=this.demoPanelRef.nativeElement,s=this.canvasRef.nativeElement;i.clientHeight>i.clientWidth?(s.width=i.clientHeight-160,s.height=i.clientWidth-10,s.style.transform="rotate(90deg)"):(s.width=i.clientWidth-160,s.height=i.clientHeight-10),this.startGame(s),onbeforeunload=()=>{this.game&&this.game.destroy()}}}ngOnDestroy(){localStorage.removeItem(I.$.inDemo),this.game&&this.game.destroy()}startGame(i){this.game=new g(i,this.demoService.demoSettings),this.game.run()}}return d.\u0275fac=function(i){return new(i||d)(p.Y36(Q.e),p.Y36(z.n),p.Y36(C.F0))},d.\u0275cmp=p.Xpm({type:d,selectors:[["app-demo"]],viewQuery:function(i,s){if(1&i&&(p.Gf(N,5),p.Gf(j,5)),2&i){let e;p.iGM(e=p.CRH())&&(s.demoPanelRef=e.first),p.iGM(e=p.CRH())&&(s.canvasRef=e.first)}},decls:7,vars:0,consts:[[1,"wrapper"],[1,"back-link",3,"click"],[1,"demo-panel"],["demoPanel",""],[1,"demo-canvas"],["canvas",""]],template:function(i,s){1&i&&(p.TgZ(0,"div",0)(1,"div",1),p.NdJ("click",function(){return s.onClose()}),p._uU(2,"Close Demo"),p.qZA(),p.TgZ(3,"div",2,3),p._UZ(5,"canvas",4,5),p.qZA()())},styles:["@keyframes make_visible_move_right_on_start{0%{left:0;transform:translate(-100%,-50%)}to{left:0;transform:translateY(-50%)}}@keyframes make_hidden_move_left_from_start{0%{left:0;transform:translateY(-50%)}to{left:0;transform:translate(-100%,-50%)}}@keyframes make_visible_move_right_on_center{0%{left:0;transform:translate(-100%,-50%)}to{left:50%;transform:translate(-50%,-50%)}}@keyframes make_hidden_move_left_from_center{0%{left:50%;transform:translate(-50%,-50%)}to{left:0;transform:translate(-100%,-50%)}}@keyframes make_visible_move_right_on_end{0%{left:0;transform:translate(-100%,-50%)}to{left:100%;transform:translate(-100%,-50%)}}@keyframes make_hidden_move_left_from_end{0%{left:100%;transform:translate(-100%,-50%)}to{left:0;transform:translate(-100%,-50%)}}@keyframes make_visible_move_left_on_end{0%{left:100%;transform:translateY(-50%)}to{left:100%;transform:translate(-100%,-50%)}}@keyframes make_hidden_move_right_from_end{0%{left:100%;transform:translate(-100%,-50%)}to{left:100%;transform:translateY(-50%)}}@keyframes make_visible_move_left_on_center{0%{left:100%;transform:translateY(-50%)}to{left:50%;transform:translate(-50%,-50%)}}@keyframes make_hidden_move_right_from_center{0%{left:50%;transform:translate(-50%,-50%)}to{left:100%;transform:translateY(-50%)}}@keyframes make_visible_move_left_on_start{0%{left:100%;transform:translateY(-50%)}to{left:0;transform:translateY(-50%)}}@keyframes make_hidden_move_right_from_start{0%{left:0;transform:translateY(-50%)}to{left:100%;transform:translateY(-50%)}}@keyframes switch-blue{0%{left:0;right:50%}to{left:50%;right:0}}@keyframes switch-red{0%{left:50%;right:0}to{left:0;right:50%}}.wrapper[_ngcontent-%COMP%]{width:100vw;height:100vh;overflow:hidden;position:relative}.wrapper[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]{color:#ce9f25;font-size:14px;font-weight:700;padding:5px;background:#1E1E1E;border-radius:5px;cursor:pointer;position:absolute;top:10px;left:20px;z-index:10}.wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;margin:0;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]   .demo-canvas[_ngcontent-%COMP%]{border:2px solid #EB3636;cursor:url(cursor.8e939e809d527865.png) 20 20,auto}"]}),d})()}];let J=(()=>{class d{}return d.\u0275fac=function(i){return new(i||d)},d.\u0275mod=p.oAB({type:d}),d.\u0275inj=p.cJS({imports:[U.ez,C.Bz.forChild(K),C.Bz]}),d})(),Z=(()=>{class d{}return d.\u0275fac=function(i){return new(i||d)},d.\u0275mod=p.oAB({type:d}),d.\u0275inj=p.cJS({imports:[U.ez,J]}),d})()}}]);