import{f as k}from "./chunk-GYWX2ZNF.js";var G=Object.defineProperty,F=(l, t, s)=>t in l?G(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s,h=(l, t, s)=>F(l,typeof t!="symbol"?t+"":t,s),g=Object.freeze({Dev:"dev",Prod:"prod"}),Y=g.Prod,X=class{constructor(t, s, i){h(this,"renderX",0),h(this,"renderY",0),h(this,"deltaWidth",0),h(this,"deltaHeight",0),h(this,"unitWidth",0),h(this,"baseWidth",280),h(this,"frontWidth",0),h(this,"frontHeight",0),h(this,"backWidth",0),h(this,"backHeight",0),h(this,"barrier",1e3),this.canvas=t,this.mapImg=s,this.unitWidth=i.width,this.frontWidth=s.width,this.frontHeight=s.height,this.backWidth=this.frontWidth+2*this.barrier,this.backHeight=this.frontHeight+2*this.barrier}calculateDelta(){this.deltaWidth=this.frontWidth-this.canvas.width,this.deltaHeight=this.frontHeight-this.canvas.height}moveMap(t, s){this.calculateDelta(),t<=10&&this.renderX>0?this.renderX-=10:this.renderX<0&&(this.renderX=0),s<=10&&this.renderY>0?this.renderY-=10:this.renderY<0&&(this.renderY=0),t>=this.canvas.width-10&&this.renderX<this.deltaWidth?this.renderX+=10:this.renderX>this.deltaWidth&&(this.renderX=this.deltaWidth),s>=this.canvas.height-10&&this.renderY<this.deltaHeight?this.renderY+=10:this.renderY>this.deltaHeight&&(this.renderY=this.deltaHeight)}},p=Object.freeze({Red:"red",Blue:"blue",Green:"green"}),f=Object.freeze({InWar:"inWar",Winner:"winner",Defeated:"defeated"}),x=class{constructor(){h(this,"playerName","Player"),h(this,"position",0),h(this,"team",p.Red),h(this,"tankHead","gun_1"),h(this,"tankBody","T_1")}},I=class{constructor(){h(this,"tankHead","gun_1"),h(this,"tankBody","T_1"),h(this,"name","Player"),h(this,"team",p.Red),h(this,"level",0),h(this,"kills",0),h(this,"deaths",0),h(this,"date",Date.now())}},A=class{constructor(){h(this,"gameStatus",f.InWar),h(this,"player",new I),h(this,"bots",[])}},d=class{constructor(t, s){h(this,"X",0),h(this,"Y",0),this.X=t,this.Y=s}},n=class{};h(n,"right",0),h(n,"bottom",1),h(n,"left",2),h(n,"top",3);var T=class{constructor(t, s, i){h(this,"road",0),h(this,"wall",1),h(this,"closeRoad",2),h(this,"redBase",3),h(this,"blueBase",4),h(this,"bullet",5),h(this,"water",6),h(this,"sand",7),h(this,"hpRegenRed",8),h(this,"hpRegenBlue",9),h(this,"cpRegen",10),h(this,"next",11),h(this,"units",[]),h(this,"towers",[]),h(this,"mobs",[]),h(this,"homes",[]);for(let e=0; e<t; ++e)this.units.push(this.next+e);for(let e=0; e<t; ++e)this.homes.push(this.next+t+e);for(let e=0; e<s; ++e)this.towers.push(this.next+2*t+e);for(let e=0; e<i; ++e)this.mobs.push(this.next+2*t+s+e)}},y=class{constructor(){h(this,"coords",new d(0,0)),h(this,"pastCoords",new d(0,0)),h(this,"renderCoords",new d(0,0)),h(this,"crashCoords",new d(0,0)),h(this,"renderCrashCoords",new d(0,0)),h(this,"deltaCoords",new d(0,0))}},M=class{constructor(){h(this,"kills",0),h(this,"deaths",0),h(this,"status",f.InWar)}},C=class{constructor(t="T_2", s=20, i=20, e=6, r=2, u=200, c=600, a=1, m=0, w=0){this.model=t,this.health=s,this.armor=i,this.speed=e,this.shotPower=r,this.shotDistance=u,this.respawnTime=c,this.level=a,this.experience=m,this.commandPoints=w}};function v(l, t){return Math.floor(Math.random()*(t-l)+l)}var o=class{constructor(t=0, s=0, i=0, e=0, r=0){this.id=r,this.width=i,this.height=e,this.TLX=t,this.TLY=s,this.BRX=this.TLX+this.width,this.BRY=this.TLY+this.height}update(t){this.TLX=t.X,this.TLY=t.Y,this.BRX=this.TLX+this.width,this.BRY=this.TLY+this.height}},R=class extends o{constructor(t){super(),h(this,"map",null),h(this,"pos",null),h(this,"owner",null),h(this,"target",null),h(this,"turn",0),h(this,"speed",0),h(this,"bulletType",{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new d(0,0),boom_coords:new d(0,0)}),h(this,"hit",!1),h(this,"hitMiss",!1),h(this,"degree",0),this.map=t.map,this.pos=new y,this.owner=t,this.id=t.id,this.bulletType=t.ammunition[t.bulletType]}look(){let t=this.pos.coords.X+Math.round(this.map.unitWidth/3),s=this.pos.coords.Y+Math.round(this.map.unitWidth/3),i=[];this.update(new d(t,s));for(let e=0; e<this.map.backArray.length; ++e)this.BRX<this.map.backArray[e].TLX||this.TLX>this.map.backArray[e].BRX||this.BRY<this.map.backArray[e].TLY||this.TLY>this.map.backArray[e].BRY||i.push(this.map.backArray[e].id);return i.length===0&&i.push(this.map.backId.road),i}fatalHit(){return this.target!==null&&this.target.uc.health<=0?(this.target.uc.health=0,this.target):(this.target=null,null)}hitResult(){return v(this.bulletType.damage,this.owner.uc.shotPower+this.bulletType.damage)}checkHitMiss(t){return t.forEach(s=>{this.hitMiss=s===this.map.backId.wall}),this.hitMiss}checkHit(t){this.hit=!1;for(let s of this.owner.targets)t.forEach(i=>{if(i===s.id&&s.uc.health>0){this.target=s;let e=this.hitResult();s.uc.armor=s.uc.armor-e*2/3,s.uc.armor<=0?(s.uc.armor=0,s.uc.health=s.uc.health-e):s.uc.health=s.uc.health-e/3,this.hit=!0}});return this.hit}moveHelper(t, s){let i=Math.cos(this.degree*Math.PI/180)*s,e=Math.sin(this.degree*Math.PI/180)*s;t.X+=Math.round(i),t.Y+=Math.round(e)}move(){this.speed===0&&(this.pos.coords=Object.assign({},this.owner.pos.coords),this.pos.renderCoords=Object.assign({},this.owner.pos.renderCoords),this.degree=this.owner.gun.degree,this.turn=this.owner.turn,this.bulletType=this.owner.ammunition[this.owner.bulletType],--this.owner.ammunition[this.owner.bulletType].quantity);let t=Math.floor(this.owner.uc.shotDistance/10);this.moveHelper(this.pos.coords,t),this.moveHelper(this.pos.renderCoords,t);let s=this.look();++this.speed,(this.checkHitMiss(s)||this.checkHit(s))&&(this.speed=0),this.speed>10&&(this.speed=0)}},U=class extends o{constructor(t=new C, s={model:"gun_2",degree:0}, i=[{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new d(0,0),boom_coords:new d(0,0)}], e=0, r=new M){super(),h(this,"userId","None"),h(this,"name","Bot"),h(this,"side",p.Red),h(this,"homeId",1111),h(this,"ability",0),h(this,"turn",0),h(this,"bulletType",0),h(this,"reload",0),h(this,"speedController",1),h(this,"trigger",!1),h(this,"uc",null),h(this,"stats",null),h(this,"etalonUc",null),h(this,"kill",null),h(this,"map",null),h(this,"bullet",null),h(this,"pos",null),h(this,"targets",null),h(this,"allies",null),h(this,"ammunition",null),h(this,"gun",null),this.uc=t,this.etalonUc=Object.assign({},this.uc),this.ammunition=i,this.bullet=new R(this),this.pos=new y,this.gun=s,this.ability=e,this.stats=r}levelUp(){this.kill!==null&&(this.uc.experience+=this.kill.etalonUc.health,++this.stats.kills,this.uc.experience>this.uc.level*20&&(this.uc.experience-=this.uc.level*20,++this.uc.level,++this.etalonUc.level,++this.uc.commandPoints,++this.etalonUc.commandPoints,this.uc.level%2===0&&(this.etalonUc.health+=5),this.uc.level%2!==0&&(this.etalonUc.armor+=5),this.etalonUc.speed<12&&this.uc.level%3===0&&(this.uc.speed+=1,this.etalonUc.speed+=1),this.etalonUc.shotPower<=10&&this.uc.level%2!==0&&(this.uc.shotPower+=1,this.etalonUc.shotPower+=1))),this.experienceToLevel=this.uc.level*20}roadEffect(t){this.side===p.Red?(t===this.map.backId.hpRegenRed&&this.uc.health<this.etalonUc.health&&(this.uc.health+=.1),t===this.map.backId.hpRegenBlue&&this.uc.health>=0&&(this.uc.health-=.1)):(t===this.map.backId.hpRegenBlue&&this.uc.health<this.etalonUc.health&&(this.uc.health+=.1),t===this.map.backId.hpRegenRed&&this.uc.health>=0&&(this.uc.health-=.1)),t===this.map.backId.cpRegen&&this.uc.armor<this.etalonUc.armor&&(this.uc.armor+=.1),t===this.map.backId.sand&&(this.uc.speed=2,this.speedController=2)}checkFrontWay(t){let s=!1,i=this.look(t),e=!0;return i.forEach(r=>{r===this.map.backId.hpRegenRed||r===this.map.backId.cpRegen||r===this.map.backId.hpRegenBlue||r===this.map.backId.sand?s=!0:e=r===this.map.backId.road,s?this.roadEffect(r):this.uc.speed=this.etalonUc.speed}),e}look(t){this.update(this.pos.coords);let s=[];switch(this.turn){case n.right:{for(let i=0; i<this.map.backArray.length; ++i)this.BRX+t+1<this.map.backArray[i].TLX||this.TLX+t+1>this.map.backArray[i].BRX||this.BRY<this.map.backArray[i].TLY||this.TLY>this.map.backArray[i].BRY||this.id===this.map.backArray[i].id||this.homeId===this.map.backArray[i].id||s.push(this.map.backArray[i].id);break}case n.bottom:{for(let i=0; i<this.map.backArray.length; ++i)this.BRX<this.map.backArray[i].TLX||this.TLX>this.map.backArray[i].BRX||this.BRY+t+1<this.map.backArray[i].TLY||this.TLY+t+1>this.map.backArray[i].BRY||this.id===this.map.backArray[i].id||this.homeId===this.map.backArray[i].id||s.push(this.map.backArray[i].id);break}case n.left:{for(let i=0; i<this.map.backArray.length; ++i)this.BRX-t-1<this.map.backArray[i].TLX||this.TLX-t-1>this.map.backArray[i].BRX||this.BRY<this.map.backArray[i].TLY||this.TLY>this.map.backArray[i].BRY||this.id===this.map.backArray[i].id||this.homeId===this.map.backArray[i].id||s.push(this.map.backArray[i].id);break}case n.top:{for(let i=0; i<this.map.backArray.length; ++i)this.BRX<this.map.backArray[i].TLX||this.TLX>this.map.backArray[i].BRX||this.BRY-t-1<this.map.backArray[i].TLY||this.TLY-t-1>this.map.backArray[i].BRY||this.id===this.map.backArray[i].id||this.homeId===this.map.backArray[i].id||s.push(this.map.backArray[i].id);break}}return s.length===0&&s.push(this.map.backId.road),s}setPosition(t, s){switch(this.turn){case n.right:{this.pos.coords.X=s?this.pos.coords.X+t:this.pos.coords.X-t;break}case n.bottom:{this.pos.coords.Y=s?this.pos.coords.Y+t:this.pos.coords.Y-t;break}case n.left:{this.pos.coords.X=s?this.pos.coords.X-t:this.pos.coords.X+t;break}case n.top:{this.pos.coords.Y=s?this.pos.coords.Y-t:this.pos.coords.Y+t;break}}this.update(this.pos.coords)}searchTarget(t){let s=t.pos.coords.X<this.pos.coords.X+this.uc.shotDistance&&t.pos.coords.X>this.pos.coords.X-this.uc.shotDistance,i=t.pos.coords.Y<this.pos.coords.Y+this.uc.shotDistance&&t.pos.coords.Y>this.pos.coords.Y-this.uc.shotDistance;return s&&i&&t.uc.health>0}},W=class extends U{constructor(t=p.Blue, s="T_2", i=100, e=20, r=5, u=1, c=200, a=100, m={model:"gun_2",degree:0,coords:new d(0,0)}, w=[{model:"bullet_1",damage:1,quantity:1e4,shot_model:"bullet_1_shot",boom_model:"bullet_1_boom",shot_coords:new d(0,0),boom_coords:new d(0,0)}], $=0){super(new C(s,i,e,r,u,c,a),m,w,$),h(this,"directionPriority",!0),h(this,"turnFlag",!0),h(this,"counter",0),h(this,"target",null),h(this,"name","Bot"),this.side=t}checkTarget1(t){switch(this.turn){case n.right:{this.turn=this.directionPriority?n.top:n.bottom;let s=this.checkCollision(!1);return this.turn=n.right,this.pos.coords.X<t.pos.coords.X||s}case n.bottom:{this.turn=this.directionPriority?n.right:n.left;let s=this.checkCollision(!1);return this.turn=n.bottom,this.pos.coords.Y<t.pos.coords.Y||s}case n.left:{this.turn=this.directionPriority?n.bottom:n.top;let s=this.checkCollision(!1);return this.turn=n.left,this.pos.coords.X>t.pos.coords.X||s}case n.top:{this.turn=this.directionPriority?n.left:n.right;let s=this.checkCollision(!1);return this.turn=n.top,this.pos.coords.Y>t.pos.coords.Y||s}}return!0}checkTarget2(t){let s=this.uc.shotDistance-Math.round(this.uc.shotDistance/4),i=t.id!==this.map.backId.redBase&&t.id!==this.map.backId.blueBase?this.map.unitWidth+2:Math.round(this.map.unitWidth/2);switch(this.turn){case n.right:return this.pos.coords.X<t.pos.coords.X-s||this.pos.coords.Y>t.pos.coords.Y+i||this.pos.coords.Y<t.pos.coords.Y-i;case n.bottom:return this.pos.coords.Y<t.pos.coords.Y-s||this.pos.coords.X>t.pos.coords.X+i||this.pos.coords.X<t.pos.coords.X-i;case n.left:return this.pos.coords.X>t.pos.coords.X+s||this.pos.coords.Y>t.pos.coords.Y+i||this.pos.coords.Y<t.pos.coords.Y-i;case n.top:return this.pos.coords.Y>t.pos.coords.Y+s||this.pos.coords.X>t.pos.coords.X+i||this.pos.coords.X<t.pos.coords.X-i}return!0}checkCollision(t){let s=!1;if(t)for(let i=this.uc.speed; i>0&&(s=!1,this.setPosition(i,!0),this.checkFrontWay(i)||(this.setPosition(i,!1),s=!0),s!==!1); --i);else this.checkFrontWay(this.uc.speed)||(s=!0);return s}hunt(t){this.turnGun(t),t!==null&&this.uc.health>0&&(this.directionPriority?this.turnFlag===!1&&this.turn===n.top?this.turn=n.right:this.turnFlag===!1&&(this.turn+=1):this.turnFlag===!1&&this.turn===n.right?this.turn=n.top:this.turnFlag===!1&&(this.turn-=1),this.side===p.Red&&this.turnFlag?this.directionPriority=this.pos.coords.Y<Math.round(this.map.frontHeight/2):this.turnFlag&&(this.directionPriority=this.pos.coords.Y>Math.round(this.map.frontHeight/2)),this.turnFlag=!0,this.checkTarget1(t)?this.checkTarget2(t)&&this.checkCollision(!0)&&this.checkCollision(!1)&&(this.turn=this.directionPriority?this.turn-1:this.turn+1,this.turnClosure(),this.turnFlag=this.checkCollision(!0)):this.turn=this.directionPriority?this.turn-1:this.turn+1,this.turnClosure())}turnClosure(){this.turn<n.right&&(this.turn=n.top),this.turn>n.top&&(this.turn=n.right)}turnGun(t){let s=Math.round(this.map.unitWidth/2),i=Math.round(this.map.unitWidth/2),e=t.pos.coords.X+Math.round(this.map.unitWidth/2),r=t.pos.coords.Y+Math.round(this.map.unitWidth/2),u=this.pos.coords.X+s,c=this.pos.coords.Y+i,a=(r-c)/(e-u);u<=e?this.gun.degree=Math.atan(a)*180/Math.PI:this.gun.degree=Math.atan(a)*180/Math.PI+180}shot(){this.counter++;let t=null;for(let s of this.targets)if(this.uc.health>0&&s.uc.health>0&&this.searchTarget(s)){t=s;break}t!==null&&(this.turnGun(t),this.trigger=!0),this.trigger&&(this.counter%2===0&&this.reload===this.bullet.speed&&this.bullet.move(),this.counter%2===0&&this.reload++,this.kill=this.bullet.fatalHit(),this.kill!==null&&(this.bullet.target=null,this.levelUp(),this.kill=null),this.reload>10&&(this.trigger=!1,this.bullet.hit=!1,this.bullet.hitMiss=!1,this.reload=0))}},B=class extends X{constructor(t, s, i){super(t,s,i),h(this,"unitsCount",8),h(this,"towersCount",18),h(this,"mobsCount",6),h(this,"backArray",[]),h(this,"unitsCoords",[]),h(this,"startUnitsTurn",[]),h(this,"baseTowers",[]),h(this,"towers",[]),h(this,"mobs",[]),h(this,"etalonMobs",[]),h(this,"redBase",null),h(this,"blueBase",null),h(this,"etalonTower",null),h(this,"backId",null),this.backId=new T(this.unitsCount,this.towersCount,this.mobsCount);let e={model:"gun_1",degree:0},r={model:"gun_3",degree:0},u={model:"gun_5",degree:0};this.redBase=new W(p.Red,"",200,0),this.redBase.tower1=new W(p.Red,"tower_1",100,0,0,3,350,0,_.cloneDeep(e)),this.redBase.tower2=new W(p.Red,"tower_1",100,0,0,3,350,0,_.cloneDeep(e)),this.blueBase=new W(p.Blue,"",200,0),this.blueBase.tower1=new W(p.Blue,"tower_2",100,0,0,3,350,0,_.cloneDeep(r)),this.blueBase.tower2=new W(p.Blue,"tower_2",100,0,0,3,350,0,_.cloneDeep(r)),this.etalonTower=new W("","",100,0,0,3,350),Math.round(this.unitWidth*2/3);let c=Math.round(this.unitWidth/3),a=Math.round(this.unitWidth/2);this.unitsCoords=[new d(this.unitWidth*3-a,this.frontHeight-this.unitWidth*12-a),new d(this.unitWidth*3-a,this.frontHeight-this.unitWidth*9-a),new d(this.unitWidth*9-a,this.frontHeight-this.unitWidth*3-a),new d(this.unitWidth*12-a,this.frontHeight-this.unitWidth*3-a),new d(this.frontWidth-this.unitWidth*3-a,this.frontHeight-this.unitWidth*13+a),new d(this.frontWidth-this.unitWidth*3-a,this.frontHeight-this.unitWidth*10+a),new d(this.frontWidth-this.unitWidth*9-a,this.frontHeight-this.unitWidth*3-a),new d(this.frontWidth-this.unitWidth*12-a,this.frontHeight-this.unitWidth*3-a)],this.startUnitsTurn=[n.right,n.right,n.top,n.top,n.left,n.left,n.top,n.top],this.baseTowers=[this.redBase.tower1,this.redBase.tower2,this.blueBase.tower1,this.blueBase.tower2],this.redBase.tower1.pos.coords=new d(this.unitWidth*9+a,this.unitWidth*10+a),this.redBase.tower2.pos.coords=new d(this.unitWidth*9+a,this.unitWidth*15+a),this.blueBase.tower1.pos.coords=new d(this.frontWidth-this.unitWidth*11+a,this.unitWidth*9+a),this.blueBase.tower2.pos.coords=new d(this.frontWidth-this.unitWidth*11+a,this.unitWidth*14+a);for(let m=0; m<9; ++m)this.towers.push(new W(p.Red,"tower_1",100,0,0,3,350,0,_.cloneDeep(e)));for(let m=0; m<9; ++m)this.towers.push(new W(p.Blue,"tower_2",100,0,0,3,350,0,_.cloneDeep(r)));this.towersCoords=[new d(this.unitWidth*16,this.unitWidth*8),new d(this.unitWidth*15,this.unitWidth*4),new d(this.unitWidth*17,this.unitWidth*14),new d(this.unitWidth*17,this.unitWidth*18),new d(this.unitWidth*16,this.unitWidth*24+c),new d(this.unitWidth*15,this.unitWidth*28+c),new d(this.unitWidth*27,this.unitWidth*2),new d(this.unitWidth*28,this.unitWidth*15),new d(this.unitWidth*27,this.frontHeight-this.unitWidth*3),new d(this.frontWidth-this.unitWidth*16,this.unitWidth*4),new d(this.frontWidth-this.unitWidth*17,this.unitWidth*8),new d(this.frontWidth-this.unitWidth*18,this.unitWidth*14),new d(this.frontWidth-this.unitWidth*18,this.unitWidth*18),new d(this.frontWidth-this.unitWidth*17,this.unitWidth*24+c),new d(this.frontWidth-this.unitWidth*16,this.unitWidth*28+c),new d(this.frontWidth-this.unitWidth*28,this.unitWidth*2),new d(this.frontWidth-this.unitWidth*29,this.unitWidth*17),new d(this.frontWidth-this.unitWidth*28,this.frontHeight-this.unitWidth*3)];for(let m=0; m<6; ++m)this.mobs.push(new W(p.Green,"tower_3",15,0,0,3,250,1e3,_.cloneDeep(u))),this.etalonMobs.push(new W(p.Green,"tower_3",15,0,0,3,250,1e3,_.cloneDeep(u)));this.mobsCoords=[new d(this.unitWidth*24+a,this.unitWidth*10+a),new d(this.unitWidth*24+a,this.unitWidth*21),new d(this.unitWidth*23+a,this.unitWidth*24+a),new d(this.frontWidth-this.unitWidth*25-a,this.unitWidth*9+a),new d(this.frontWidth-this.unitWidth*25-a,this.unitWidth*20),new d(this.frontWidth-this.unitWidth*24-a,this.unitWidth*24)],this.mapInit()}mapInit(){let t=Math.round(this.unitWidth*2/3),s=Math.round(this.unitWidth/3);this.backArray.push(new o(0,0,7*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(0,this.frontHeight-8*this.unitWidth,4*this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(4*this.unitWidth,this.frontHeight-6*this.unitWidth,this.unitWidth,6*this.unitWidth,this.backId.wall)),this.backArray.push(new o(5*this.unitWidth,this.frontHeight-5*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(6*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(0,5*this.unitWidth,2*this.unitWidth,this.frontHeight-8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-11*this.unitWidth,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(2*this.unitWidth,5*this.unitWidth,2*this.unitWidth,15*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(7*this.unitWidth,0,22*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,2*this.unitWidth,10*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(8*this.unitWidth,this.frontHeight-2*this.unitWidth,21*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(10*this.unitWidth,this.frontHeight-4*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(13*this.unitWidth,this.frontHeight-3*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(13*this.unitWidth,this.frontHeight-4*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(17*this.unitWidth,9*this.unitWidth,4*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(20*this.unitWidth,6*this.unitWidth,6*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,7*this.unitWidth,this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,7*this.unitWidth,2*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,12*this.unitWidth,2*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(25*this.unitWidth,10*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(28*this.unitWidth,6*this.unitWidth,this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(28*this.unitWidth,11*this.unitWidth,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(17*this.unitWidth,this.frontHeight-14*this.unitWidth-s,4*this.unitWidth,5*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-14*this.unitWidth-s,3*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-13*this.unitWidth-s,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(24*this.unitWidth,this.frontHeight-10*this.unitWidth-s,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(25*this.unitWidth,this.frontHeight-13*this.unitWidth-s,this.unitWidth,3*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(25*this.unitWidth,this.frontHeight-9*this.unitWidth-s,this.unitWidth,3*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(20*this.unitWidth,this.frontHeight-7*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(23*this.unitWidth,this.frontHeight-9*this.unitWidth-s,this.unitWidth,2*this.unitWidth+s,this.backId.closeRoad)),this.backArray.push(new o(28*this.unitWidth,this.frontHeight-15*this.unitWidth-s,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(28*this.unitWidth,this.frontHeight-9*this.unitWidth-s,this.unitWidth,3*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(this.frontWidth-7*this.unitWidth,0,7*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-8*this.unitWidth,4*this.unitWidth,8*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-5*this.unitWidth,this.frontHeight-6*this.unitWidth,this.unitWidth,6*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-6*this.unitWidth,this.frontHeight-5*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-8*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-2*this.unitWidth,5*this.unitWidth,2*this.unitWidth,20*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-11*this.unitWidth,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,5*this.unitWidth,2*this.unitWidth,15*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,0,22*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-20*this.unitWidth,2*this.unitWidth,10*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-18*this.unitWidth,3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-2*this.unitWidth,21*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,this.frontHeight-3*this.unitWidth,8*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-18*this.unitWidth,this.frontHeight-4*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,this.frontHeight-4*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,9*this.unitWidth,4*this.unitWidth,5*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,6*this.unitWidth,6*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,7*this.unitWidth,3*this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,9*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,11*this.unitWidth,3*this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,9*this.unitWidth,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,6*this.unitWidth,this.unitWidth,3*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,11*this.unitWidth,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-21*this.unitWidth,this.frontHeight-14*this.unitWidth-s,4*this.unitWidth,5*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-15*this.unitWidth-s,3*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,this.frontHeight-14*this.unitWidth-s,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-11*this.unitWidth-s,2*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-10*this.unitWidth-s,this.unitWidth,4*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(this.frontWidth-25*this.unitWidth,this.frontHeight-7*this.unitWidth,5*this.unitWidth,this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-26*this.unitWidth,this.frontHeight-14*this.unitWidth-s,this.unitWidth,2*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-24*this.unitWidth,this.frontHeight-10*this.unitWidth-s,this.unitWidth,3*this.unitWidth+s,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-15*this.unitWidth-s,this.unitWidth,4*this.unitWidth,this.backId.wall)),this.backArray.push(new o(this.frontWidth-29*this.unitWidth,this.frontHeight-9*this.unitWidth-s,this.unitWidth,3*this.unitWidth+s,this.backId.wall)),this.backArray.push(new o(29*this.unitWidth,0,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,6*this.unitWidth,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,11*this.unitWidth,8*this.unitWidth+t,4*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,18*this.unitWidth,8*this.unitWidth+t,4*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,24*this.unitWidth,8*this.unitWidth+t,3*this.unitWidth+s,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,30*this.unitWidth+s,8*this.unitWidth+t,3*this.unitWidth,this.backId.water)),this.backArray.push(new o(29*this.unitWidth,9*this.unitWidth,9*this.unitWidth+t,2*this.unitWidth,this.backId.sand)),this.backArray.push(new o(29*this.unitWidth,22*this.unitWidth,9*this.unitWidth+t,2*this.unitWidth,this.backId.sand)),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-13*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[0])),this.backArray.push(new o(2*this.unitWidth,this.frontHeight-10*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[1])),this.backArray.push(new o(8*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[2])),this.backArray.push(new o(11*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[3])),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-13*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[4])),this.backArray.push(new o(this.frontWidth-4*this.unitWidth,this.frontHeight-10*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[5])),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[6])),this.backArray.push(new o(this.frontWidth-13*this.unitWidth,this.frontHeight-4*this.unitWidth,2*this.unitWidth,2*this.unitWidth,this.backId.homes[7])),this.backArray.push(new o(7*this.unitWidth,2*this.unitWidth,3*this.unitWidth,3*this.unitWidth-20,this.backId.hpRegenRed)),this.backArray.push(new o(4*this.unitWidth,5*this.unitWidth,3*this.unitWidth-20,3*this.unitWidth,this.backId.cpRegen)),this.backArray.push(new o(this.frontWidth-7*this.unitWidth+20,5*this.unitWidth,3*this.unitWidth-20,3*this.unitWidth,this.backId.cpRegen)),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,2*this.unitWidth,3*this.unitWidth,3*this.unitWidth-20,this.backId.hpRegenBlue)),this.backArray.push(new o(4*this.unitWidth,11*this.unitWidth,6*this.unitWidth,5*this.unitWidth,this.backId.redBase)),this.backArray.push(new o(4*this.unitWidth,10*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(10*this.unitWidth,11*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(4*this.unitWidth,16*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-10*this.unitWidth,10*this.unitWidth,6*this.unitWidth,5*this.unitWidth,this.backId.blueBase)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,9*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,10*this.unitWidth,this.unitWidth,5*this.unitWidth,this.backId.closeRoad)),this.backArray.push(new o(this.frontWidth-11*this.unitWidth,15*this.unitWidth,7*this.unitWidth,this.unitWidth,this.backId.closeRoad))}},H=class{constructor(){h(this,"images",new Map([["map_1",new Image(4e3,2e3)],["bullet_1",new Image(60,60)],["bullet_1_shot",new Image(60,60)],["bullet_1_boom",new Image(60,60)],["T_1",new Image(60,60)],["T_2",new Image(60,60)],["T_3",new Image(60,60)],["T_4",new Image(60,60)],["tower_1",new Image(60,60)],["tower_2",new Image(60,60)],["tower_3",new Image(60,60)],["gun_1",new Image(60,60)],["gun_2",new Image(60,60)],["gun_3",new Image(60,60)],["gun_4",new Image(60,60)],["gun_5",new Image(60,60)],["red_crash",new Image(60,60)],["blue_crash",new Image(60,60)],["smoke_1",new Image(60,60)]])),h(this,"counter",0);let t=Y===g.Dev?"../../../":"";this.images.get("map_1").src=`${t}images/testGame/map_1.png`,this.images.get("bullet_1").src=`${t}images/testGame/bullet_1.png`,this.images.get("bullet_1_shot").src=`${t}images/testGame/bullet_1_shot.png`,this.images.get("bullet_1_boom").src=`${t}images/testGame/bullet_1_boom.png`,this.images.get("T_1").src=`${t}images/testGame/T_1.png`,this.images.get("T_2").src=`${t}images/testGame/T_2.png`,this.images.get("T_3").src=`${t}images/testGame/T_3.png`,this.images.get("T_4").src=`${t}images/testGame/T_4.png`,this.images.get("tower_1").src=`${t}images/testGame/tower_1.png`,this.images.get("tower_2").src=`${t}images/testGame/tower_2.png`,this.images.get("tower_3").src=`${t}images/testGame/tower_3.png`,this.images.get("gun_1").src=`${t}images/testGame/gun_1.png`,this.images.get("gun_2").src=`${t}images/testGame/gun_2.png`,this.images.get("gun_3").src=`${t}images/testGame/gun_3.png`,this.images.get("gun_4").src=`${t}images/testGame/gun_4.png`,this.images.get("gun_5").src=`${t}images/testGame/gun_5.png`,this.images.get("red_crash").src=`${t}images/testGame/red_crash.png`,this.images.get("blue_crash").src=`${t}images/testGame/blue_crash.png`,this.images.get("smoke_1").src=`${t}images/testGame/smoke_1.png`}allUploaded(){return k(this,null,function*(){let t=this.images.values().map(s=>new Promise(i=>s.onload=()=>i()));return Promise.all(t)})}},S=class{constructor(t, s, i, e, r, u){h(this,"sounds",new Map),h(this,"counter",0);let c=Y===g.Dev?"../../../":"";e.forEach(a=>{a.id===i.id?this.sounds.set(a.id,new Audio(`${c}sounds/ShotLoud.mp3`)):this.sounds.set(a.id,new Audio(`${c}sounds/ShotQuit.mp3`))}),r.forEach(a=>{this.sounds.set(a.id,new Audio(`${c}sounds/ShotQuit.mp3`))}),u.forEach(a=>{this.sounds.set(a.id,new Audio(`${c}sounds/ShotQuit.mp3`))}),this.sounds.set(t.tower1.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(t.tower2.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(s.tower1.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set(s.tower2.id,new Audio(`${c}sounds/ShotQuit.mp3`)),this.sounds.set("Wind",new Audio(`${c}sounds/Wind.mp3`))}},E=class{constructor(t, s, i){h(this,"map",null),h(this,"uI",0),h(this,"etalonUnits",[]),h(this,"cloneUnits",[]),this.map=t,this.etalonUnits=s,this.userId=i,this.uI=this.findUser(),this.preparation(),this.counter=0,this.pause=!1,this.defeat=!1,this.win=!1,this.bonus=0}findUser(){for(let t=0; t<this.etalonUnits.length; ++t)if(this.userId===this.etalonUnits[t].userId)return t}preparation(){this.etalonUnits.forEach((t, s)=>{t.pos.coords.X=this.map.unitsCoords[s].X,t.pos.coords.Y=this.map.unitsCoords[s].Y,t.turn=this.map.startUnitsTurn[s],t.id=this.map.backId.units[s],t.homeId=this.map.backId.homes[s],t.gun.degree=t.turn*90,this.cloneUnits[s]=_.cloneDeep(t),this.cloneUnits[s].map=t.map=this.map,this.cloneUnits[s].width=this.cloneUnits[s].height=this.map.unitWidth,this.cloneUnits[s].bullet.map=t.bullet.map=this.map,this.cloneUnits[s].bullet.width=this.cloneUnits[s].bullet.height=Math.round(this.map.unitWidth/5),this.map.backArray.push(this.cloneUnits[s]),this.userId===t.userId&&(this.cloneUnits[s].control=t.control,this.cloneUnits[s].control.mouseMove(),this.cloneUnits[s].control.mouseDown(),this.cloneUnits[s].control.mouseUp(),this.cloneUnits[s].control.keyDown(),this.cloneUnits[s].control.keyUp())}),this.map.towers.forEach((t, s)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.towers[s],t.pos.coords=this.map.towersCoords[s],t.turn=t.side===p.Blue?n.left:n.right,t.gun.degree=t.side===p.Blue?180:0,t.targets=this.cloneUnits.filter(i=>t.side!==i.side),t.allies=this.cloneUnits.filter(i=>t.side===i.side),t.width=t.height=this.map.unitWidth,this.map.backArray.push(t),t.update(t.pos.coords)}),this.map.mobs.forEach((t, s)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.mobs[s],t.pos.coords=this.map.mobsCoords[s],t.targets=this.cloneUnits.filter(i=>t.side!==i.side),t.allies=this.cloneUnits.filter(i=>t.side===i.side),t.width=t.height=this.map.unitWidth,this.map.backArray.push(t),t.update(t.pos.coords)}),this.map.etalonMobs.forEach((t, s)=>{t.map=this.map,t.bullet.map=this.map,t.id=this.map.backId.mobs[s],t.pos.coords=this.map.mobsCoords[s],t.targets=this.cloneUnits.filter(i=>t.side!==i.side),t.allies=this.cloneUnits.filter(i=>t.side===i.side)}),this.cloneUnits.forEach(t=>{t.targets=this.cloneUnits.filter(s=>t.side!==s.side),this.map.towers.filter(s=>t.side!==s.side).forEach(s=>{t.targets.push(s)}),this.map.mobs.filter(s=>t.side!==s.side).forEach(s=>{t.targets.push(s)}),t.targets.push(t.side===p.Red?this.map.blueBase:this.map.redBase),t.allies=this.cloneUnits.filter(s=>t.side===s.side)}),this.map.baseTowers.forEach(t=>{t.map=this.map,t.bullet.map=this.map,t.targets=this.cloneUnits.filter(s=>t.side!==s.side),t.allies=this.cloneUnits.filter(s=>t.side===s.side)}),this.map.redBase.id=this.map.backId.redBase,this.map.blueBase.id=this.map.backId.blueBase,this.map.redBase.tower1.id=1e3,this.map.blueBase.tower2.id=1001,this.map.blueBase.tower1.id=1002,this.map.blueBase.tower2.id=1003,this.sound=new S(this.map.redBase,this.map.blueBase,this.cloneUnits[this.uI],this.cloneUnits,this.map.towers,this.map.mobs)}unitsBackFill(){this.cloneUnits.forEach(t=>{t.pos.pastCoords.X=t.pos.coords.X,t.pos.pastCoords.Y=t.pos.coords.Y,t.update(t.pos.coords),t.checkFrontWay(1)})}run(){this.cloneUnits[this.uI].control.buttonUp==="Space"&&(this.pause=this.pause===!1,this.cloneUnits[this.uI].control.buttonUp=""),!this.pause&&!this.win&&!this.defeat&&(this.counter++,this.counter>5400&&(this.counter=0),this.unitsBackFill(),this.cloneUnits.forEach((t, s)=>{this.uI!==s&&(this.botLogic(t),t.target!==null&&t.hunt(t.target),t.shot(),this.crash(t,this.etalonUnits[s]),this.rebirth(t,this.etalonUnits[s]))}),this.map.baseTowers.forEach(t=>{t.shot()}),this.map.towers.forEach(t=>{t.shot()}),this.map.mobs.forEach((t, s)=>{t.uc.health<t.etalonUc.health&&t.shot(),this.crash(t,this.map.etalonMobs[s]),this.rebirth(t,this.map.etalonMobs[s])}),this.cloneUnits[this.uI].controlHandling(),this.cloneUnits[this.uI].shot(),this.crash(this.cloneUnits[this.uI],this.etalonUnits[this.uI]),this.rebirth(this.cloneUnits[this.uI],this.etalonUnits[this.uI]),this.gameOver())}gameOver(){this.cloneUnits[this.uI].side===p.Red&&this.map.blueBase.uc.health<=0||this.cloneUnits[this.uI].side===p.Blue&&this.map.redBase.uc.health<=0?(this.cloneUnits[this.uI].stats.status=f.Winner,++this.etalonUnits[this.uI].wins,++this.etalonUnits[this.uI].battles,this.etalonUnits[this.uI].stats.kills=this.cloneUnits[this.uI].stats.kills,this.bonus=v(500,1e3),this.etalonUnits[this.uI].money+=this.bonus,this.win=!0):(this.cloneUnits[this.uI].side===p.Red&&this.map.redBase.uc.health<=0||this.cloneUnits[this.uI].side===p.Blue&&this.map.blueBase.uc.health<=0)&&(this.cloneUnits[this.uI].stats.status=f.Defeated,++this.etalonUnits[this.uI].defeats,++this.etalonUnits[this.uI].battles,this.etalonUnits[this.uI].stats.kills=this.cloneUnits[this.uI].stats.kills,this.bonus=v(200,300),this.etalonUnits[this.uI].money+=this.bonus,this.defeat=!0)}botLogic(t){var s;if(this.counter%1200===0||this.counter===1||t.target===null||t.target.uc.health<=0){let i=new Map;t.targets.forEach((u, c)=>{let a=Math.abs(u.pos.coords.X-t.pos.coords.X),m=Math.abs(u.pos.coords.Y-t.pos.coords.Y);i.set(u,Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(m,2))))});let e=[...i.entries()].sort((u, c)=>u[1]-c[1]).map(([u,c])=>u).filter(u=>!t.allies.find(c=>{var a;return((a=c.target)==null?void 0:a.id)===u.id})),r=!1;for(let u of e){for(let c of t.allies){if(((s=c.target)==null?void 0:s.id)===u.id)break;if(u.uc.health>0){t.target=u,r=!0;break}}if(r)break}}}crash(t, s){t.uc.health<=0&&t.uc.respawnTime===t.etalonUc.respawnTime&&(t.pos.crashCoords.X=t.pos.coords.X,t.pos.crashCoords.Y=t.pos.coords.Y,t.turn=s.turn,t.gun.degree=s.gun.degree,t.pos.coords.X=s.pos.coords.X,t.pos.coords.Y=s.pos.coords.Y,++t.stats.deaths),t.uc.health<=0&&--t.uc.respawnTime}rebirth(t){t.uc.respawnTime<=0&&(t.uc.respawnTime=t.etalonUc.respawnTime,t.uc.armor=t.etalonUc.armor,t.uc.health=t.etalonUc.health)}getState(){return this.cloneUnits.reduce((t, s, i)=>{let e=new I;return e.tankBody=s.uc.model,e.tankHead=s.gun.model,e.name=s.name,e.team=s.side,e.level=s.uc.level,e.kills=s.stats.kills,e.deaths=s.stats.deaths,e.date=Date.now(),i===this.uI?(t.gameStatus=s.stats.status,t.player=e,t):(t.bots=t.bots?[...t.bots,e]:[e],t)},new A)}},P=class extends U{constructor(t, s, i){super(),h(this,"experienceToLevel",0),h(this,"money",0),h(this,"battles",0),h(this,"wins",0),h(this,"defeats",0),h(this,"counter",0),h(this,"control",null),this.userId=s,this.side=i.team,this.name=i.playerName,this.control=t,this.uc.model=i.tankBody,this.etalonUc.model=i.tankBody,this.gun.model=i.tankHead}checkCollision(t){let s=!1;for(let r=this.speedController; r>0&&(s=!1,this.setPosition(r,!0),this.checkFrontWay(r)||(this.setPosition(r,!1),s=!0),s!==!1); r--);let i=this.pos.coords.X-this.pos.pastCoords.X,e=this.pos.coords.Y-this.pos.pastCoords.Y;if(this.pos.deltaCoords.X=i,this.pos.deltaCoords.Y=e,t&&!s){let r=this.pos.renderCoords.X+this.pos.deltaCoords.X,u=this.pos.renderCoords.Y+this.pos.deltaCoords.Y;this.pos.renderCoords.X=r,this.pos.renderCoords.Y=u}}shot(){this.trigger===!0&&(this.counter%2===0&&this.reload===this.bullet.speed&&this.bullet.move(),this.counter%2===0&&this.reload++,this.kill=this.bullet.fatalHit(),this.kill!==null&&(this.bullet.target=null,this.levelUp(),this.kill=null),this.reload>10&&(this.trigger=!1,this.bullet.hit=!1,this.bullet.hitMiss=!1,this.reload=0))}extraMove(t){this.uc.health>0&&(this.speedController<this.uc.speed&&this.counter%2===0&&++this.speedController,this.checkCollision(t))}checkMapSides(){let t=this.map.renderY>=this.uc.speed,s=this.pos.coords.Y<=this.map.frontHeight-Math.floor(this.control.canvas.height/2),i=this.map.renderY<=this.map.frontHeight-this.control.canvas.height-this.uc.speed,e=this.pos.coords.Y>=Math.floor(this.control.canvas.height/2),r=this.map.renderX>=this.uc.speed,u=this.pos.coords.X<=this.map.frontWidth-Math.floor(this.control.canvas.width/2),c=this.map.renderX<=this.map.frontWidth-this.control.canvas.width-this.uc.speed,a=this.pos.coords.X>=Math.floor(this.control.canvas.width/2);if(this.turn===n.top)return t&&s;if(this.turn===n.bottom)return i&&e;if(this.turn===n.left)return r&&u;if(this.turn===n.right)return c&&a}correctRenderCoords1(){this.map.renderX-=this.pos.deltaCoords.X,this.map.renderY-=this.pos.deltaCoords.Y,this.targets.forEach(t=>{t.bullet.pos.renderCoords.X+=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y+=this.pos.deltaCoords.Y}),this.allies.forEach(t=>{t.bullet.pos.renderCoords.X+=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y+=this.pos.deltaCoords.Y})}correctRenderCoords2(){this.map.renderX+=this.pos.deltaCoords.X,this.map.renderY+=this.pos.deltaCoords.Y,this.targets.forEach(t=>{t.bullet.pos.renderCoords.X-=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y-=this.pos.deltaCoords.Y}),this.allies.forEach(t=>{t.bullet.pos.renderCoords.X-=this.pos.deltaCoords.X,t.bullet.pos.renderCoords.Y-=this.pos.deltaCoords.Y})}move(t){this.checkMapSides()?(t(!1),this.pos.deltaCoords.X<0||this.pos.deltaCoords.Y<0?this.turn===n.right||this.turn===n.bottom?this.correctRenderCoords1():this.correctRenderCoords2():this.turn===n.right||this.turn===n.bottom?this.correctRenderCoords2():this.correctRenderCoords1()):t(!0)}turnGun(){let t=Math.round(this.map.unitWidth/2),s=Math.round(this.map.unitWidth/2),i=this.pos.renderCoords.X+t,e=this.pos.renderCoords.Y+s,r=(this.control.mouseY-e)/(this.control.mouseX-i);i<this.control.mouseX?this.gun.degree=Math.atan(r)*180/Math.PI:this.gun.degree=Math.atan(r)*180/Math.PI+180}controlHandling(){if(this.uc.health>0)switch(this.turnGun(),this.counter++,this.counter>1e3&&(this.counter=0),this.control.buttonDown){case"ArrowUp":case"KeyW":this.turn=n.top,this.move(t=>this.extraMove(t));break;case"ArrowDown":case"KeyS":this.turn=n.bottom,this.move(t=>this.extraMove(t));break;case"ArrowLeft":case"KeyA":this.turn=n.left,this.move(t=>this.extraMove(t));break;case"ArrowRight":case"KeyD":this.turn=n.right,this.move(t=>this.extraMove(t));break;default:this.speedController>0&&this.counter%4===0&&this.control.buttonUp!==""&&(--this.speedController,this.move(t=>this.checkCollision(t)))}this.control.buttonUp!==""&&(this.control.buttonDown=""),this.control.checkMouseDown&&this.uc.health>0&&(this.trigger=!0),this.control.checkMouseUp&&(this.control.checkMouseDown=!1,this.control.checkMouseUp=!1)}},D=class{constructor(t, s, i, e){h(this,"pic",null),h(this,"canvas",null),h(this,"context",null),h(this,"map",null),h(this,"etalonUnits",[]),h(this,"cloneUnits",[]),h(this,"uI",0),h(this,"game",null),this.game=e,this.map=e.map,this.pic=t,this.canvas=s,this.context=i,this.etalonUnits=e.etalonUnits,this.cloneUnits=e.cloneUnits,this.userId=e.userId,this.uI=e.uI,this.crashDegrees=0,this.userPreparation(),this.othersPreparation()}userPreparation(){let t=Math.round(this.canvas.width/2),s=Math.round(this.canvas.height/2),i=this.cloneUnits[this.uI].pos.coords.X+t>=this.map.frontWidth,e=this.map.frontWidth-this.cloneUnits[this.uI].pos.coords.X,r=i?e:t,u=this.cloneUnits[this.uI].pos.coords.Y+s>=this.map.frontHeight,c=this.map.frontHeight-this.cloneUnits[this.uI].pos.coords.Y,a=u?c:s;this.cloneUnits[this.uI].pos.coords.X>=this.canvas.width?(this.map.renderX=this.cloneUnits[this.uI].pos.coords.X+r-this.canvas.width,this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX,this.etalonUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX):(this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X,this.etalonUnits[this.uI].pos.renderCoords.X=this.etalonUnits[this.uI].pos.coords.X),this.cloneUnits[this.uI].pos.coords.Y>this.canvas.height?(this.map.renderY=this.cloneUnits[this.uI].pos.coords.Y+a-this.canvas.height,this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY,this.etalonUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY):(this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y,this.etalonUnits[this.uI].pos.renderCoords.Y=this.etalonUnits[this.uI].pos.coords.Y)}othersPreparation(){for(let t=0; t<this.cloneUnits.length; ++t)t!==this.uI&&(this.cloneUnits[t].pos.renderCoords.X=this.cloneUnits[t].pos.coords.X-this.cloneUnits[this.uI].map.renderX,this.cloneUnits[t].pos.renderCoords.Y=this.cloneUnits[t].pos.coords.Y-this.map.renderY,this.cloneUnits[t].bullet.pos.renderCoords.X=this.cloneUnits[t].bullet.pos.coords.X-this.map.renderX,this.cloneUnits[t].bullet.pos.renderCoords.Y=this.cloneUnits[t].bullet.pos.coords.Y-this.map.renderY);this.map.baseTowers.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.towers.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.mobs.forEach(t=>{t.pos.renderCoords.X=t.pos.coords.X-this.cloneUnits[this.uI].map.renderX,t.pos.renderCoords.Y=t.pos.coords.Y-this.cloneUnits[this.uI].map.renderY,t.bullet.pos.renderCoords.X=t.bullet.pos.coords.X-this.map.renderX,t.bullet.pos.renderCoords.Y=t.bullet.pos.coords.Y-this.map.renderY}),this.map.redBase.pos.renderCoords.X=this.map.unitWidth*4-this.map.renderX,this.map.redBase.pos.renderCoords.Y=this.map.unitWidth*11-this.map.renderY,this.map.blueBase.pos.renderCoords.X=this.map.frontWidth-this.map.unitWidth*4-this.map.renderX,this.map.blueBase.pos.renderCoords.Y=this.map.unitWidth*10-this.map.renderY}showUnitModel(t){let s=0;t.turn===n.right&&(s=0),t.turn===n.bottom&&(s=90),t.turn===n.left&&(s=180),t.turn===n.top&&(s=270),this.rotateImage(s,this.map.unitWidth,this.map.unitWidth,t.pos.renderCoords,()=>{this.context.drawImage(this.pic.images.get(t.uc.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}),this.showGunModel(t)}showGunModel(t){t.uc.health>0&&this.rotateImage(t.gun.degree,this.map.unitWidth,this.map.unitWidth,t.pos.renderCoords,()=>{this.context.drawImage(this.pic.images.get(t.gun.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))})}rotateImage(t, s, i, e, r){this.context.save(),this.context.translate(e.X+Math.floor(s/2),e.Y+Math.floor(i/2)),this.context.rotate(t*(Math.PI/180)),r(),this.context.restore()}showShot(t){this.showBullet(t.bullet.degree,t),this.showShotMoment(t.bullet.degree,t),this.showBoomMoment(t.bullet.degree,t)}showBullet(t, s){if(s.bullet.speed===1&&(this.game.sound.sounds.get(s.id).currentTime=0,this.game.sound.sounds.get(s.id).play()),s.bullet.speed!==0){let i=this.pic.images.get(s.ammunition[s.bulletType].model);this.rotateImage(t,i.width,i.height,s.bullet.pos.renderCoords,()=>{this.context.drawImage(i,-Math.floor(i.width/2),-Math.floor(i.height/2))})}}showShotMoment(t, s){if(s.bullet.speed===2||s.bullet.speed===3){let i=this.pic.images.get(s.ammunition[s.bulletType].shot_model);s.bullet.speed===2&&(s.bullet.bulletType.shot_coords.X=s.bullet.pos.renderCoords.X,s.bullet.bulletType.shot_coords.Y=s.bullet.pos.renderCoords.Y),this.rotateImage(t,i.width,i.height,s.bullet.bulletType.shot_coords,()=>{this.context.drawImage(i,-Math.floor(i.width/2),-Math.floor(i.height/2))})}}showBoomMoment(t, s){if(s.bullet.hit||s.bullet.hitMiss){let i=this.pic.images.get(s.ammunition[s.bulletType].boom_model);s.bullet.bulletType.boom_coords.X=s.bullet.pos.renderCoords.X,s.bullet.bulletType.boom_coords.Y=s.bullet.pos.renderCoords.Y,this.rotateImage(t,i.width,i.height,s.bullet.bulletType.boom_coords,()=>{this.context.drawImage(i,-Math.floor(i.width/2),-Math.floor(i.height/2))})}}healthArmorBalancer(t, s, i){return t*i/s}showArmor(t){if(t.uc.health>0){let s=this.map.unitWidth-20+3;this.context.fillStyle="darkOrange";let i=this.healthArmorBalancer(t.uc.armor,t.etalonUc.armor,s);switch(t.turn){case n.right:{this.context.fillRect(t.pos.renderCoords.X-28,t.pos.renderCoords.Y+20+s-i,4,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-28,t.pos.renderCoords.Y+20,4,s-i);break}case n.bottom:{this.context.fillRect(t.pos.renderCoords.X-3+s-i,t.pos.renderCoords.Y-28,i,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y-28,s-i,4);break}case n.left:{this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+28-4,t.pos.renderCoords.Y+20+s-i,4,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+28-4,t.pos.renderCoords.Y+20,4,s-i);break}case n.top:{this.context.fillRect(t.pos.renderCoords.X-3+s-i,t.pos.renderCoords.Y+this.map.unitWidth+28-4,i,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y+this.map.unitWidth+28-4,s-i,4);break}}}}showHealth(t){if(t.uc.health>0){let s=this.map.unitWidth-20+3;this.context.fillStyle=t.side===p.Red?"darkRed":t.side===p.Green?"darkGreen":"blue";let i=this.healthArmorBalancer(t.uc.health,t.etalonUc.health,s);switch(t.turn){case n.right:{this.context.fillRect(t.pos.renderCoords.X-24,t.pos.renderCoords.Y+20+s-i,4,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-24,t.pos.renderCoords.Y+20,4,s-i);break}case n.bottom:{this.context.fillRect(t.pos.renderCoords.X-3+s-i,t.pos.renderCoords.Y-24,i,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y-24,s-i,4);break}case n.left:{this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+24-4,t.pos.renderCoords.Y+20+s-i,4,i),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+this.map.unitWidth+24-4,t.pos.renderCoords.Y+20,4,s-i);break}case n.top:{this.context.fillRect(t.pos.renderCoords.X-3+s-i,t.pos.renderCoords.Y+this.map.unitWidth+24-4,i,4),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-3,t.pos.renderCoords.Y+this.map.unitWidth+24-4,s-i,4);break}}}}showLevel(t){if(t.uc.health>0){this.context.save(),this.context.fillStyle="rgb(255, 255, 255)",this.context.font="16px Arial";let s=30;switch(t.turn){case n.right:{this.context.textAlign="center";let i=t.pos.renderCoords.X-s-1*2+(25/2+16/2),e=t.pos.renderCoords.Y-3+18/2;this.context.translate(i,e),this.context.rotate(270*Math.PI/180);break}case n.bottom:{this.context.textAlign="center";let i=t.pos.renderCoords.X+this.map.unitWidth+3-18/2,e=t.pos.renderCoords.Y-s-1*2+(25/2+16/2);this.context.translate(i,e);break}case n.left:{this.context.textAlign="center";let i=t.pos.renderCoords.X+this.map.unitWidth+(s-25-1*2)+25/2+16/2,e=t.pos.renderCoords.Y-3+18/2;this.context.translate(i,e),this.context.rotate(270*Math.PI/180);break}case n.top:{this.context.textAlign="center";let i=t.pos.renderCoords.X+this.map.unitWidth+3-18/2,e=t.pos.renderCoords.Y+this.map.unitWidth+(s-25-1*2)+25/2+16/2;this.context.translate(i,e);break}}this.context.fillText(`${t.uc.level}`,0,0,21),this.context.restore()}}showName(t){if(t.uc.health>0){let s=3+this.map.unitWidth-18;this.context.save(),this.context.fillStyle="rgb(255, 255, 255)",this.context.strokeStyle="rgb(255, 255, 255)",this.context.font="100 13px Arial";let i=30;switch(t.turn){case n.right:{this.context.textAlign="center";let r=t.pos.renderCoords.X-i-2*1+25,u=t.pos.renderCoords.Y+this.map.unitWidth+3-1-s/2;this.context.translate(r,u),this.context.rotate(270*Math.PI/180);break}case n.bottom:{this.context.textAlign="center";let r=t.pos.renderCoords.X-3+1+s/2,u=t.pos.renderCoords.Y-i-1*2+25;this.context.translate(r,u);break}case n.left:{this.context.textAlign="center";let r=t.pos.renderCoords.X+this.map.unitWidth+i-2*1-25/2,u=t.pos.renderCoords.Y+this.map.unitWidth+3-1-s/2;this.context.translate(r,u),this.context.rotate(270*Math.PI/180);break}case n.top:{this.context.textAlign="center";let r=t.pos.renderCoords.X-3+1+s/2,u=t.pos.renderCoords.Y+this.map.unitWidth+i-2*1-25/2;this.context.translate(r,u);break}}let e=this.restrictText(this.context,`${t.name}`,0,0,s);this.context.fillText(e,0,0,s),this.context.restore()}}showUCContainer(t){if(t.uc.health>0){let s=this.map.unitWidth+10,i,e;switch(this.context.save(),this.context.fillStyle="rgba(60, 50, 50, 0.7)",this.context.strokeStyle="rgb(20, 20, 20)",this.context.lineJoin="round",this.context.lineWidth=1,this.context.beginPath(),t.turn){case n.right:{i=t.pos.renderCoords.X-30,e=t.pos.renderCoords.Y-5,this.context.roundRect(i,e,25,s,3);break}case n.bottom:{i=t.pos.renderCoords.X-5,e=t.pos.renderCoords.Y-30,this.context.roundRect(i,e,s,25,3);break}case n.left:{i=t.pos.renderCoords.X+30-25+this.map.unitWidth,e=t.pos.renderCoords.Y-5,this.context.roundRect(i,e,25,s,3);break}case n.top:{i=t.pos.renderCoords.X-5,e=t.pos.renderCoords.Y+30-25+this.map.unitWidth,this.context.roundRect(i,e,s,25,3);break}}this.context.stroke(),this.context.fill(),this.context.restore()}}showBaseHealth(t){if(t.uc.health>0){let s=this.healthArmorBalancer(t.uc.health,t.etalonUc.health,this.map.baseWidth);this.context.fillStyle=t.side===p.Red?"darkRed":"blue",t.side===p.Red?(this.context.fillRect(t.pos.renderCoords.X-20,t.pos.renderCoords.Y+this.map.baseWidth-s,12,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X-20,t.pos.renderCoords.Y,12,this.map.baseWidth-s)):(this.context.fillRect(t.pos.renderCoords.X+20,t.pos.renderCoords.Y+this.map.baseWidth-s,12,s),this.context.fillStyle="rgb(60, 50, 50)",this.context.fillRect(t.pos.renderCoords.X+20,t.pos.renderCoords.Y,12,this.map.baseWidth-s))}}showCrash(t){t.uc.health<=0&&(t.pos.renderCrashCoords.X=t.pos.crashCoords.X-this.map.renderX,t.pos.renderCrashCoords.Y=t.pos.crashCoords.Y-this.map.renderY,this.rotateImage(0,this.map.unitWidth,this.map.unitWidth,t.pos.renderCrashCoords,()=>{this.context.drawImage(this.pic.images.get(t.uc.model),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}),++this.crashDegrees,this.rotateImage(this.crashDegrees,this.map.unitWidth,this.map.unitWidth,t.pos.renderCrashCoords,()=>{this.context.drawImage(this.pic.images.get("smoke_1"),-Math.floor(this.map.unitWidth/2),-Math.floor(this.map.unitWidth/2))}))}isVisible(t){return!(t.pos.renderCoords.X>this.canvas.width+this.map.unitWidth||t.pos.renderCoords.X<-this.map.unitWidth||t.pos.renderCoords.Y>this.canvas.height+this.map.unitWidth||t.pos.renderCoords.X<-this.map.unitWidth)}render(){if(this.game.counter===5&&(this.game.sound.sounds.get("Wind").currentTime=0,this.game.sound.sounds.get("Wind").play()),this.othersPreparation(),this.cloneUnits[this.uI].uc.respawnTime===1?(this.map.renderX=0,this.map.renderY=0,this.userPreparation()):this.cloneUnits[this.uI].uc.health<=0&&this.map.moveMap(this.cloneUnits[this.uI].control.mouseX,this.cloneUnits[this.uI].control.mouseY),this.context.drawImage(this.map.mapImg,this.map.renderX,this.map.renderY,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height),this.cloneUnits.forEach(t=>{this.showCrash(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showUnitModel(t)}),this.map.towers.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.map.baseTowers.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.map.mobs.forEach(t=>{this.isVisible(t)&&this.showUnitModel(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.towers.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.baseTowers.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.map.mobs.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&this.showShot(t)}),this.cloneUnits.forEach(t=>{t.uc.health>0&&this.isVisible(t)&&(this.showUCContainer(t),this.showName(t),this.showHealth(t),this.showArmor(t),this.showLevel(t))}),this.map.towers.forEach(t=>{this.isVisible(t)&&this.showHealth(t)}),this.map.mobs.forEach(t=>{this.isVisible(t)&&this.showHealth(t)}),this.isVisible(this.map.redBase)&&this.showBaseHealth(this.map.redBase),this.isVisible(this.map.blueBase)&&this.showBaseHealth(this.map.blueBase),this.showUC(),this.game.win||this.game.defeat){this.cloneUnits[this.uI].pos.renderCoords.X=this.cloneUnits[this.uI].pos.coords.X-this.map.renderX,this.cloneUnits[this.uI].pos.renderCoords.Y=this.cloneUnits[this.uI].pos.coords.Y-this.map.renderY,this.cloneUnits[this.uI].bullet.pos.renderCoords.X=this.cloneUnits[this.uI].bullet.pos.coords.X-this.map.renderX,this.cloneUnits[this.uI].bullet.pos.renderCoords.Y=this.cloneUnits[this.uI].bullet.pos.coords.Y-this.map.renderY,this.map.moveMap(this.cloneUnits[this.uI].control.mouseX,this.cloneUnits[this.uI].control.mouseY),this.context.fillStyle="rgba(60, 50, 50, 0.8)",this.context.strokeStyle="rgb(20, 20, 20)";let t=Math.round(this.canvas.width/10),s=Math.round(this.canvas.height/10),i=t*8,e=s*8,r=20;this.context.lineJoin="round",this.context.lineWidth=r,this.context.strokeRect(t+r/2,s+r/2,i-r,e-r),this.context.fillRect(t+r/2,s+r/2,i-r,e-r),this.game.win&&this.winMessage(s),this.game.defeat&&this.defeatMessage(s)}}showUC(){this.context.fillStyle="rgb(0, 0, 0)",this.context.font="20px Palatino Linotype",this.context.lineWidth=2;let t=20,s=20;this.strokedText(`Level: ${this.cloneUnits[this.uI].uc.level}`,t,s),this.strokedText(`Exp: ${Math.floor(this.cloneUnits[this.uI].uc.experience)} / ${Math.floor(this.cloneUnits[this.uI].experienceToLevel)}`,t,s*2),this.strokedText(`Health: ${Math.floor(this.cloneUnits[this.uI].uc.health)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.health)}`,t,s*3),this.strokedText(`Armor: ${Math.floor(this.cloneUnits[this.uI].uc.armor)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.armor)}`,t,s*4),this.strokedText(`Speed: ${Math.floor(this.cloneUnits[this.uI].uc.speed)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.speed)}`,t,s*5),this.strokedText(`Power: ${Math.floor(this.cloneUnits[this.uI].uc.shotPower)} / ${Math.floor(this.cloneUnits[this.uI].etalonUc.shotPower)}`,t,s*6)}winMessage(t){this.context.textAlign="center";let s=Math.round(this.canvas.width/2);this.context.fillStyle="rgb(255, 255, 255)",this.context.font="48px Palatino Linotype",this.context.lineWidth=5,this.strokedText("PERFECT VICTORY",s,t*2),this.context.font="36px Palatino Linotype",this.context.lineWidth=3,this.strokedText("Congratulations! Your awards / achievements:",s,t*3),this.message(t)}defeatMessage(t){this.context.textAlign="center";let s=Math.round(this.canvas.width/2);this.context.fillStyle="rgb(255, 255, 255)",this.context.font="48px Palatino Linotype",this.context.lineWidth=5,this.strokedText("UNFORTUNATE DEFEAT",s,t*2),this.context.font="36px Palatino Linotype",this.context.lineWidth=3,this.strokedText("Your awards / achievements:",s,t*3),this.message(t)}message(t){let s=Math.round(this.canvas.width/2),i=Math.round(t/2);this.context.lineWidth=3,this.context.font="28px Palatino Linotype",this.strokedText(`Money: +${this.game.bonus}`,s,t*4+i),this.strokedText(`Level in game: ${this.cloneUnits[this.uI].uc.level}`,s,t*4+i*3),this.strokedText(`Kills: ${this.etalonUnits[this.uI].stats.kills}`,s,t*4+i*4),this.strokedText(`Wins: ${this.etalonUnits[this.uI].wins}`,s,t*4+i*5),this.strokedText(`Defeats: ${this.etalonUnits[this.uI].defeats}`,s,t*4+i*6),this.strokedText(`Battles: ${this.etalonUnits[this.uI].battles}`,s,t*4+i*7)}strokedText(t, s, i, e=this.canvas.width){this.context.strokeText(t,s,i,e),this.context.fillText(t,s,i,e)}restrictText(t, s, i, e, r){let u=s.split(""),c="",a="";for(let m=0; m<u.length; ++m)if(a+=u[m],t.measureText(a).width>r*1.2){for(let w=0; w<m; ++w)c+=u[w];c+="...";break}return c||(c=s),c}},L=class{constructor(t){h(this,"mouseX",0),h(this,"mouseY",0),h(this,"buttonDown",""),h(this,"buttonUp",""),h(this,"checkMouseDown",!1),h(this,"checkMouseUp",!1),this.canvas=t}mouseMove(){this.canvas.addEventListener("mousemove", t=>{this.mouseX=t.offsetX,this.mouseY=t.offsetY})}mouseDown(){this.canvas.addEventListener("mousedown",()=>{this.checkMouseDown=!0})}mouseUp(){this.canvas.addEventListener("mouseup",()=>{this.checkMouseUp=!0})}keyDown(){document.addEventListener("keydown", t=>{this.buttonDown=t.code,this.buttonUp=""})}keyUp(){document.addEventListener("keyup", t=>{this.buttonUp=t.code})}};g.Prod===Y&&(window._={cloneDeep:null},k(void 0,null,function*(){return window._.cloneDeep=(yield import("./chunk-EZQCEOQM.js").then(l=>l.i)).default}));g.Dev===Y&&k(void 0,null,function*(){let l=yield import("./chunk-WA7EAVRP.js");document.getElementById("btn0").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest1).run(),document.getElementById("btn1").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest2).run(),document.getElementById("btn2").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest3).run(),document.getElementById("btn3").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest4).run(),document.getElementById("btn4").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest5).run(),document.getElementById("btn5").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest6).run(),document.getElementById("btn6").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest7).run(),document.getElementById("btn7").onclick=()=>new b(document.querySelector("canvas"),new l.DemoSettingsTest8).run()});var b=class{constructor(t, s=new x){h(this,"map"),h(this,"game"),h(this,"control"),h(this,"units"),h(this,"renderer"),h(this,"animationFrameRef"),h(this,"stateSubscribers"),h(this,"locker",!1),this.canvas=t,this.context=this.canvas.getContext("2d"),this.control=new L(t),this.pictures=new H,this.start=new Date().getTime(),this.fps=0,this.settings=s,this.stateSubscribers=[]}draw(){this.game.run();let t=this.game.getState();this.renderer.render();let s=new Date().getTime();this.fps++,this.locker||(this.stateSubscribers.forEach(i=>i(t)),this.locker=!0),s-this.start>=3e3&&(this.stateSubscribers.forEach(i=>i(t)),this.start=s,this.fps=0),this.animationFrameRef=requestAnimationFrame(this.draw.bind(this))}run(){this.pictures.allUploaded().then(()=>{this.map=new B(this.canvas,this.pictures.images.get("map_1"),this.pictures.images.get("T_2")),this.canvas.style.cursor=this.pictures.images.get("cursor"),this.units=this.getUnits(),this.game=new E(this.map,this.units,"user"),this.renderer=new D(this.pictures,this.canvas,this.context,this.game),this.draw()})}getUnits(){let t=()=>new P(this.control,"user",this.settings),s=()=>new W(p.Red,"T_1",30,30,5,1,200,600,{model:"gun_1",degree:0,coords:new d(0,0)}),i=()=>new W(p.Blue,"T_3",30,30,5,1,200,600,{model:"gun_3",degree:0,coords:new d(0,0)}),e=this.settings.team===p.Red?this.settings.position:this.settings.position+4,r=[s(),s(),s(),s(),i(),i(),i(),i()];return r.splice(e,1,t()),r}stateObserver(t){this.stateSubscribers.push(t)}destroy(){this.animationFrameRef&&(cancelAnimationFrame(this.animationFrameRef),Array.from(this.game.sound.sounds.values()).forEach(t=>{t.pause(),t.currentTime=0}))}};export{p as a,f as b,b as c};
