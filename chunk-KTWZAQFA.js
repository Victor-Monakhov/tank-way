import{A as j,B as H,E as F,i as G,j as T,l as z,m as R,n as W}from"./chunk-JNDDCADP.js";import{d as E,s as B}from"./chunk-OJXEH74S.js";import{b as f,c as I}from"./chunk-5RKQYCRQ.js";import{Bb as w,Da as S,Fc as x,Gb as M,Lb as l,Mb as d,Nb as u,Rb as _,Vb as b,_ as g,ab as m,cc as p,dc as D,ea as s,fc as O,ib as c,ma as v,na as y,oc as k,pb as C,vb as P}from"./chunk-3GLEZGZL.js";import{d as Y,e as q}from"./chunk-GYWX2ZNF.js";var Q=Y(h=>{"use strict";h.__esModule=!0;var J=function(){function e(r){if(!r)throw new TypeError("Invalid argument; `value` has no value.");this.value=e.EMPTY,r&&e.isGuid(r)&&(this.value=r)}return e.isGuid=function(r){var o=r.toString();return r&&(r instanceof e||e.validator.test(o))},e.create=function(){return new e([e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-"))},e.createEmpty=function(){return new e("emptyguid")},e.parse=function(r){return new e(r)},e.raw=function(){return[e.gen(2),e.gen(1),e.gen(1),e.gen(1),e.gen(3)].join("-")},e.gen=function(r){for(var o="",n=0;n<r;n++)o+=((1+Math.random())*65536|0).toString(16).substring(1);return o},e.prototype.equals=function(r){return e.isGuid(r)&&this.value===r.toString()},e.prototype.isEmpty=function(){return this.value===e.EMPTY},e.prototype.toString=function(){return this.value},e.prototype.toJSON=function(){return{value:this.value}},e.validator=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i"),e.EMPTY="00000000-0000-0000-0000-000000000000",e}();h.Guid=J});var N=q(Q());var A=(()=>{class e{gameStateToDemoButtle(o,n){return[o.player,...o.bots].map(t=>({name:t.name,team:t.team,level:t.level,kills:t.kills,deaths:t.deaths,date:t.date,turret:H.find(a=>a.name===t.tankHead),hull:j.find(a=>a.name===t.tankBody)})).reduce((t,a,V)=>V?(t.bots=t.bots?[...t.bots,a]:[a],t):(t.id=n,t.battleStatus=o.gameStatus,t.player=a,t),{id:null,battleStatus:null,player:null,bots:null})}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var L=["demoPanel"],U=["canvas"],Z=e=>({"demo-canvas":!0,"canvas-ready":e});function $(e,r){e&1&&u(0,"tnm-loader",5)}var he=(()=>{class e{constructor(){if(this.stateService=s(F),this.demoService=s(A),this.router=s(B),this.demoPanelRef=c("demoPanel"),this.canvasRef=c("canvas"),this.loader=S(!0),!this.stateService.inDemo)this.router.navigate(["welcome"]).then();else{let o=this.stateService.demoPlayer();x(()=>{let n=this.stateService.demoGame();if(n){let i=n.tanks.find(t=>t.chosenAsPlayer);if(i){let t=this.demoPanelRef().nativeElement,a=this.canvasRef().nativeElement;t.clientHeight>t.clientWidth?(a.width=t.clientHeight-160,a.height=t.clientWidth-10,a.style.transform="rotate(90deg)"):(a.width=t.clientWidth-160,a.height=t.clientHeight-10),this.startGame(a,{tankHead:i.turret.name,tankBody:i.hull.name,position:i.position.position,team:i.position.team,playerName:o.name}),onbeforeunload=()=>{this.game&&this.game.destroy()}}}})}}ngOnDestroy(){this.stateService.inDemo=!1,this.game&&this.game.destroy()}onClose(){this.router.navigate([""]).then()}startGame(o,n){let i=N.Guid.create().toString();this.game=new I(o,n),this.game.stateObserver(t=>{this.loader()?this.stateService.addDemoBattle(this.demoService.gameStateToDemoButtle(t,i)):this.stateService.updateDemoBattle(this.demoService.gameStateToDemoButtle(t,i)),this.updatePlayerStats(),this.loader.set(!1)}),this.game.run()}updatePlayerStats(){let o=this.stateService.demoBattles(),n=this.stateService.demoPlayer();n.totalBattles=o.length;let i=o.reduce((t,a)=>(t.totalWins=a.battleStatus===f.Winner?t.totalWins+1:t.totalWins,t.totalDefeats=a.battleStatus===f.Defeated?t.totalDefeats+1:t.totalDefeats,t.totalKills+=a.player.kills,t),{totalWins:0,totalDefeats:0,totalKills:0,zrists:n.zrists,arenas:n.arenas});this.stateService.updateDemoPlayerState(i)}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=C({type:e,selectors:[["tnm-demo"]],viewQuery:function(n,i){n&1&&(p(i.demoPanelRef,L,5),p(i.canvasRef,U,5)),n&2&&D(2)},decls:9,vars:4,consts:[["demoPanel",""],["canvas",""],[1,"wrapper"],["mat-mini-fab","","type","button",1,"back-link",3,"click"],[1,"demo-panel"],[1,"loader"],[3,"ngClass"]],template:function(n,i){if(n&1){let t=_();l(0,"div",2)(1,"button",3),b("click",function(){return v(t),y(i.onClose())}),l(2,"mat-icon"),O(3,"close"),d()(),l(4,"div",4,0),P(6,$,1,0,"tnm-loader",5),u(7,"canvas",6,1),d()()}n&2&&(m(6),M(i.loader()?6:-1),m(),w("ngClass",k(2,Z,!i.loader())))},dependencies:[T,G,R,z,W,E],styles:['[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{width:100vw;height:100vh;overflow:hidden;position:relative}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]{font-size:16px;font-weight:700;position:absolute;top:10px;left:20px;z-index:10}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden;margin:0;width:100%;height:100%}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]   .loader[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;width:100px;height:100px;color:var(--mat-sys-primary);transform:translate(-50%,-50%)}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]   .demo-canvas[_ngcontent-%COMP%]{border:2px solid var(--mat-sys-primary);border-radius:20px;cursor:url("./media/cursor-R2JZ5AE5.png") 20 20,auto;background:var(--mat-sys-background);opacity:0;transition:opacity .5s}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .demo-panel[_ngcontent-%COMP%]   .canvas-ready[_ngcontent-%COMP%]{opacity:1}'],changeDetection:0})}}return e})();export{he as DemoComponent};
